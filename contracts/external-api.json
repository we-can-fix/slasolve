{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "contractId": "external-api-contract-v1",
  "contractVersion": "1.0.0",
  "description": "外部 API 行為契約與 SLA 定義",
  "language": "zh-TW",
  "lastUpdated": "2025-11-25T00:00:00Z",
  
  "endpoints": [
    {
      "name": "User Service API",
      "baseUrl": "https://api.example.com/users",
      "version": "v1",
      "provider": "User Service Team",
      "sla": {
        "availability": {
          "target": "99.9%",
          "measurement_window": "monthly",
          "acceptable_range": "99.5%-100%"
        },
        "latency": {
          "p50": "50ms",
          "p95": "200ms",
          "p99": "500ms",
          "max_acceptable": "1000ms"
        },
        "error_rate": {
          "target": "<0.1%",
          "critical_threshold": "1%",
          "measurement_window": "5m"
        },
        "rate_limit": {
          "requests_per_second": 1000,
          "burst": 1500
        }
      },
      "contract": {
        "request": {
          "method": "GET",
          "path": "/users/{userId}",
          "headers": {
            "Authorization": "Bearer <token>",
            "Content-Type": "application/json"
          },
          "pathParameters": {
            "userId": {
              "type": "string",
              "format": "uuid",
              "required": true
            }
          },
          "queryParameters": {
            "include": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["profile", "permissions", "metadata"]
              },
              "required": false
            }
          }
        },
        "response": {
          "success": {
            "statusCode": 200,
            "headers": {
              "Content-Type": "application/json",
              "X-Request-Id": "string"
            },
            "schema": {
              "type": "object",
              "required": ["id", "email", "createdAt"],
              "properties": {
                "id": {"type": "string", "format": "uuid"},
                "email": {"type": "string", "format": "email"},
                "name": {"type": "string"},
                "createdAt": {"type": "string", "format": "date-time"},
                "updatedAt": {"type": "string", "format": "date-time"}
              }
            }
          },
          "errors": {
            "400": {
              "description": "Invalid request",
              "schema": {
                "type": "object",
                "properties": {
                  "error": {"type": "string"},
                  "message": {"type": "string"}
                }
              }
            },
            "404": {
              "description": "User not found",
              "schema": {
                "type": "object",
                "properties": {
                  "error": {"type": "string"},
                  "message": {"type": "string"}
                }
              }
            },
            "429": {
              "description": "Rate limit exceeded",
              "schema": {
                "type": "object",
                "properties": {
                  "error": {"type": "string"},
                  "retryAfter": {"type": "integer"}
                }
              }
            },
            "500": {
              "description": "Internal server error",
              "schema": {
                "type": "object",
                "properties": {
                  "error": {"type": "string"},
                  "requestId": {"type": "string"}
                }
              }
            }
          }
        }
      },
      "testing": {
        "examples": [
          {
            "name": "Get user by ID",
            "request": {
              "method": "GET",
              "url": "/users/123e4567-e89b-12d3-a456-426614174000",
              "headers": {
                "Authorization": "Bearer test-token"
              }
            },
            "expectedResponse": {
              "statusCode": 200,
              "bodyMatchesSchema": true
            }
          }
        ],
        "performanceTests": {
          "concurrent_users": 100,
          "duration": "60s",
          "expected_p95_latency": "200ms",
          "expected_error_rate": "<0.1%"
        }
      },
      "monitoring": {
        "healthCheck": {
          "endpoint": "/health",
          "method": "GET",
          "expectedStatus": 200,
          "interval": "30s"
        },
        "metrics": {
          "prometheus": {
            "endpoint": "/metrics",
            "key_metrics": [
              "http_requests_total",
              "http_request_duration_seconds",
              "http_requests_errors_total"
            ]
          }
        },
        "alerts": [
          {
            "name": "High error rate",
            "condition": "error_rate > 1% for 5m",
            "severity": "critical",
            "action": "page_oncall"
          },
          {
            "name": "High latency",
            "condition": "p95_latency > 500ms for 10m",
            "severity": "warning",
            "action": "notify_team"
          }
        ]
      }
    }
  ],
  
  "dependencies": {
    "required": [
      {
        "service": "Authentication Service",
        "version": ">=2.0.0",
        "contract": "auth-service-v2.json"
      },
      {
        "service": "Database",
        "type": "PostgreSQL",
        "version": ">=14.0"
      }
    ],
    "optional": [
      {
        "service": "Cache",
        "type": "Redis",
        "version": ">=7.0",
        "purpose": "Performance optimization"
      }
    ]
  },
  
  "changeLog": [
    {
      "version": "1.0.0",
      "date": "2025-11-25",
      "changes": [
        "Initial contract definition",
        "Added user retrieval endpoint",
        "Defined SLA targets"
      ],
      "breakingChanges": false
    }
  ],
  
  "governance": {
    "owner": "User Service Team",
    "reviewers": ["API Team", "Platform Team"],
    "approvalRequired": true,
    "deprecationPolicy": {
      "notice_period": "90 days",
      "support_period": "180 days"
    }
  },
  
  "compliance": {
    "dataProtection": "GDPR compliant",
    "authentication": "OAuth 2.0 + JWT",
    "encryption": "TLS 1.3",
    "audit": "All requests logged"
  },
  
  "testing_strategy": {
    "ci_integration": {
      "tool": "contract-checker.js",
      "trigger": "on_pr",
      "fail_on_violation": true
    },
    "contract_tests": {
      "tool": "pact",
      "consumer_driven": true,
      "provider_verification": true
    }
  }
}
