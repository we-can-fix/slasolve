{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://slasolve.dev/schemas/vulnerability.schema.json",
  "title": "Vulnerability Report",
  "description": "Schema for vulnerability detection results from SLASolve security scanner",
  "type": "object",
  "required": [
    "scan_id",
    "timestamp",
    "repository",
    "vulnerabilities",
    "summary"
  ],
  "properties": {
    "scan_id": {
      "type": "string",
      "description": "Unique identifier for this scan",
      "pattern": "^vuln-scan-[a-zA-Z0-9_-]+$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of scan"
    },
    "repository": {
      "type": "string",
      "description": "Repository identifier"
    },
    "commit_hash": {
      "type": "string",
      "description": "Git commit hash",
      "pattern": "^[a-f0-9]{40}$"
    },
    "scan_type": {
      "type": "string",
      "description": "Type of scan performed",
      "enum": [
        "full",
        "incremental",
        "targeted",
        "dependency"
      ]
    },
    "duration": {
      "type": "number",
      "description": "Scan duration in seconds",
      "minimum": 0
    },
    "summary": {
      "type": "object",
      "description": "Vulnerability summary",
      "required": [
        "total"
      ],
      "properties": {
        "total": {
          "type": "integer",
          "minimum": 0
        },
        "critical": {
          "type": "integer",
          "minimum": 0
        },
        "high": {
          "type": "integer",
          "minimum": 0
        },
        "medium": {
          "type": "integer",
          "minimum": 0
        },
        "low": {
          "type": "integer",
          "minimum": 0
        },
        "fixed": {
          "type": "integer",
          "minimum": 0
        },
        "new": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "vulnerabilities": {
      "type": "array",
      "description": "List of vulnerabilities found",
      "items": {
        "$ref": "#/definitions/vulnerability"
      }
    },
    "dependencies": {
      "type": "array",
      "description": "Vulnerable dependencies",
      "items": {
        "$ref": "#/definitions/dependency_vulnerability"
      }
    },
    "tools": {
      "type": "array",
      "description": "Scanning tools used",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "version": {
            "type": "string"
          },
          "rules_version": {
            "type": "string"
          }
        }
      }
    },
    "compliance": {
      "type": "object",
      "description": "Compliance status",
      "properties": {
        "owasp_top_10": {
          "type": "boolean"
        },
        "pci_dss": {
          "type": "boolean"
        },
        "slsa_level": {
          "type": "integer",
          "minimum": 0,
          "maximum": 3
        }
      }
    },
    "evidence_hash": {
      "type": "string",
      "description": "SHA256 hash of scan evidence",
      "pattern": "^[a-f0-9]{64}$"
    }
  },
  "definitions": {
    "vulnerability": {
      "type": "object",
      "required": [
        "id",
        "title",
        "severity",
        "cvss_score"
      ],
      "properties": {
        "id": {
          "type": "string",
          "description": "Vulnerability identifier",
          "pattern": "^VULN-[0-9]+$"
        },
        "cve_id": {
          "type": "string",
          "description": "CVE identifier",
          "pattern": "^CVE-[0-9]{4}-[0-9]+$"
        },
        "cwe_id": {
          "type": "string",
          "description": "CWE identifier",
          "pattern": "^CWE-[0-9]+$"
        },
        "title": {
          "type": "string",
          "description": "Vulnerability title"
        },
        "description": {
          "type": "string",
          "description": "Detailed description"
        },
        "severity": {
          "type": "string",
          "description": "Severity level",
          "enum": [
            "CRITICAL",
            "HIGH",
            "MEDIUM",
            "LOW"
          ]
        },
        "cvss_score": {
          "type": "number",
          "description": "CVSS 3.1 base score",
          "minimum": 0,
          "maximum": 10
        },
        "cvss_vector": {
          "type": "string",
          "description": "CVSS 3.1 vector string",
          "pattern": "^CVSS:3\\.[01]/.*$"
        },
        "exploitability": {
          "type": "string",
          "description": "Exploitability assessment",
          "enum": [
            "HIGH",
            "MEDIUM",
            "LOW",
            "UNKNOWN"
          ]
        },
        "location": {
          "type": "object",
          "description": "Vulnerability location",
          "properties": {
            "file": {
              "type": "string"
            },
            "line": {
              "type": "integer",
              "minimum": 1
            },
            "column": {
              "type": "integer",
              "minimum": 1
            },
            "function": {
              "type": "string"
            },
            "class": {
              "type": "string"
            }
          }
        },
        "impact": {
          "type": "object",
          "description": "Impact assessment",
          "properties": {
            "confidentiality": {
              "type": "string",
              "enum": [
                "NONE",
                "LOW",
                "HIGH"
              ]
            },
            "integrity": {
              "type": "string",
              "enum": [
                "NONE",
                "LOW",
                "HIGH"
              ]
            },
            "availability": {
              "type": "string",
              "enum": [
                "NONE",
                "LOW",
                "HIGH"
              ]
            }
          }
        },
        "remediation": {
          "type": "string",
          "description": "Remediation advice"
        },
        "fix_available": {
          "type": "boolean",
          "description": "Whether automatic fix is available"
        },
        "fix_complexity": {
          "type": "string",
          "description": "Fix complexity",
          "enum": [
            "LOW",
            "MEDIUM",
            "HIGH"
          ]
        },
        "references": {
          "type": "array",
          "description": "External references",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "discovered_at": {
          "type": "string",
          "format": "date-time"
        },
        "evidence_hash": {
          "type": "string",
          "description": "SHA256 hash of vulnerability evidence (full 64-character hash for SLSA compliance)",
          "pattern": "^[a-f0-9]{64}$"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "dependency_vulnerability": {
      "type": "object",
      "required": [
        "package",
        "version",
        "vulnerabilities"
      ],
      "properties": {
        "package": {
          "type": "string",
          "description": "Package name"
        },
        "version": {
          "type": "string",
          "description": "Current version"
        },
        "ecosystem": {
          "type": "string",
          "description": "Package ecosystem",
          "enum": [
            "npm",
            "pip",
            "maven",
            "go",
            "cargo",
            "nuget",
            "rubygems"
          ]
        },
        "vulnerabilities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "cve_id": {
                "type": "string",
                "pattern": "^CVE-[0-9]{4}-[0-9]+$"
              },
              "severity": {
                "type": "string",
                "enum": [
                  "CRITICAL",
                  "HIGH",
                  "MEDIUM",
                  "LOW"
                ]
              },
              "cvss_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 10
              },
              "description": {
                "type": "string"
              },
              "patched_versions": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        },
        "fixed_version": {
          "type": "string",
          "description": "Recommended fixed version"
        },
        "upgrade_path": {
          "type": "array",
          "description": "Upgrade path to fix",
          "items": {
            "type": "string"
          }
        },
        "license": {
          "type": "string",
          "description": "Package license"
        },
        "license_issues": {
          "type": "array",
          "description": "License compliance issues",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
