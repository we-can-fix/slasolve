{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://islasolve.com/schemas/auto-fix-bot-v2.json",
  "title": "Auto-Fix Bot Configuration Schema v2.0",
  "description": "Schema for validating Auto-Fix Bot 2.0 configuration files",
  "type": "object",
  "required": [
    "name",
    "id",
    "version",
    "owner",
    "metadata",
    "project_mapping",
    "bot_config",
    "fix_rules",
    "policy_gates",
    "evidence_generation",
    "notifications",
    "audit"
  ],
  "properties": {
    "name": {
      "type": "string",
      "description": "Name of the Auto-Fix Bot instance"
    },
    "id": {
      "type": "string",
      "description": "Unique identifier for the bot"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the configuration"
    },
    "owner": {
      "type": "object",
      "required": ["team", "contacts", "approvers"],
      "properties": {
        "team": {
          "type": "string",
          "description": "Team responsible for the bot"
        },
        "contacts": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "email"
          },
          "minItems": 1,
          "description": "Contact emails for the team"
        },
        "approvers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "List of approvers"
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["created_at", "updated_at", "labels", "compliance_tags"],
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Creation timestamp in RFC3339 format"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp in RFC3339 format"
        },
        "labels": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 2,
          "description": "Configuration labels"
        },
        "compliance_tags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["slsa-l3", "in-toto", "audit-trail", "axiom-free", "deep-validation"]
          },
          "minItems": 1,
          "description": "Compliance tags"
        },
        "project_structure": {
          "type": "string",
          "description": "Project structure identifier"
        },
        "architecture_pattern": {
          "type": "string",
          "description": "Architecture pattern used"
        }
      }
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the bot configuration"
    },
    "project_mapping": {
      "type": "object",
      "required": [
        "config_root",
        "policies_root",
        "governance_root",
        "evidence_root",
        "schemas_root",
        "scripts_root"
      ],
      "properties": {
        "config_root": {
          "type": "string",
          "description": "Root directory for configurations"
        },
        "policies_root": {
          "type": "string",
          "description": "Root directory for policies"
        },
        "governance_root": {
          "type": "string",
          "description": "Root directory for governance files"
        },
        "evidence_root": {
          "type": "string",
          "description": "Root directory for evidence storage"
        },
        "schemas_root": {
          "type": "string",
          "description": "Root directory for schemas"
        },
        "scripts_root": {
          "type": "string",
          "description": "Root directory for scripts"
        },
        "templates_root": {
          "type": "string",
          "description": "Root directory for templates"
        },
        "docs_root": {
          "type": "string",
          "description": "Root directory for documentation"
        },
        "mcp_servers_root": {
          "type": "string",
          "description": "Root directory for MCP servers"
        },
        "test_vectors_root": {
          "type": "string",
          "description": "Root directory for test vectors"
        }
      }
    },
    "bot_config": {
      "type": "object",
      "required": ["enabled", "trigger_events", "scopes"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable or disable the bot"
        },
        "trigger_events": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["push", "pull_request", "schedule", "workflow_dispatch"]
          },
          "minItems": 1,
          "description": "Events that trigger the bot"
        },
        "auto_merge": {
          "type": "boolean",
          "description": "Enable automatic merging"
        },
        "require_human_approval": {
          "type": "boolean",
          "description": "Require human approval before actions"
        },
        "max_fixes_per_run": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum fixes per run"
        },
        "timeout": {
          "type": "string",
          "pattern": "^\\d+[smh]$",
          "description": "Timeout for bot execution"
        },
        "scopes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "enabled", "paths"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Scope name"
              },
              "enabled": {
                "type": "boolean",
                "description": "Enable or disable this scope"
              },
              "paths": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "minItems": 1,
                "description": "File paths covered by this scope"
              }
            }
          },
          "minItems": 1,
          "description": "Validation scopes"
        }
      }
    },
    "fix_rules": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "priority", "enabled", "scope", "triggers", "actions"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Rule name"
          },
          "priority": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "Rule priority"
          },
          "enabled": {
            "type": "boolean",
            "description": "Enable or disable this rule"
          },
          "scope": {
            "type": "string",
            "description": "Scope this rule applies to"
          },
          "triggers": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "minItems": 1,
            "description": "Conditions that trigger this rule"
          },
          "actions": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "command"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Action name"
                },
                "command": {
                  "type": "string",
                  "description": "Command to execute"
                },
                "when": {
                  "type": "string",
                  "description": "Condition for executing this action"
                }
              }
            },
            "minItems": 1,
            "description": "Actions to perform"
          }
        }
      },
      "minItems": 1,
      "description": "Fix rules configuration"
    },
    "policy_gates": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "stage", "policies", "failure_action"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Policy gate name"
          },
          "stage": {
            "type": "string",
            "enum": ["pre-fix", "post-fix"],
            "description": "Stage when this gate is applied"
          },
          "policies": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["path", "engine", "required"],
              "properties": {
                "path": {
                  "type": "string",
                  "description": "Path to policy file"
                },
                "engine": {
                  "type": "string",
                  "enum": ["OPA", "kyverno", "jsonschema"],
                  "description": "Policy engine to use"
                },
                "required": {
                  "type": "boolean",
                  "description": "Whether this policy is required"
                },
                "min_score": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Minimum score required"
                }
              }
            },
            "minItems": 1,
            "description": "Policies to enforce"
          },
          "failure_action": {
            "type": "string",
            "enum": ["block", "warn", "create_issue"],
            "description": "Action to take on failure"
          },
          "success_action": {
            "type": "string",
            "enum": ["auto_approve", "notify", "continue"],
            "description": "Action to take on success"
          },
          "notification": {
            "type": "object",
            "properties": {
              "slack": {
                "type": "string",
                "description": "Slack channel for notifications"
              },
              "email": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "email"
                },
                "description": "Email addresses for notifications"
              }
            }
          },
          "evidence_requirements": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "description": "Evidence requirements for this gate"
          }
        }
      },
      "minItems": 1,
      "description": "Policy gates configuration"
    },
    "evidence_generation": {
      "type": "object",
      "required": ["enabled", "storage_backend", "generators"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable evidence generation"
        },
        "storage_backend": {
          "type": "string",
          "description": "Storage backend for evidence"
        },
        "immutable": {
          "type": "boolean",
          "description": "Whether evidence storage is immutable"
        },
        "generators": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "trigger", "command"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Generator name"
              },
              "trigger": {
                "type": "string",
                "description": "Event that triggers this generator"
              },
              "command": {
                "type": "string",
                "description": "Command to execute"
              }
            }
          },
          "minItems": 1,
          "description": "Evidence generators"
        }
      }
    },
    "notifications": {
      "type": "object",
      "required": ["channels", "events"],
      "properties": {
        "channels": {
          "type": "object",
          "properties": {
            "slack": {
              "type": "object",
              "properties": {
                "webhook_url": {
                  "type": "string",
                  "description": "Slack webhook URL"
                },
                "channel": {
                  "type": "string",
                  "description": "Slack channel"
                },
                "mention_on_failure": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Users to mention on failure"
                }
              }
            },
            "email": {
              "type": "object",
              "properties": {
                "smtp_server": {
                  "type": "string",
                  "description": "SMTP server"
                },
                "recipients": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "format": "email"
                  },
                  "description": "Email recipients"
                }
              }
            },
            "github": {
              "type": "object",
              "properties": {
                "create_issue": {
                  "type": "boolean",
                  "description": "Create GitHub issues"
                },
                "assign_to": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Users to assign issues to"
                },
                "labels": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Labels for issues"
                }
              }
            }
          }
        },
        "events": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["trigger", "message", "severity"],
            "properties": {
              "trigger": {
                "type": "string",
                "description": "Event that triggers notification"
              },
              "message": {
                "type": "string",
                "description": "Notification message template"
              },
              "severity": {
                "type": "string",
                "enum": ["info", "warning", "error", "critical"],
                "description": "Notification severity"
              },
              "escalate": {
                "type": "boolean",
                "description": "Whether to escalate"
              },
              "require_manual_review": {
                "type": "boolean",
                "description": "Whether manual review is required"
              }
            }
          },
          "minItems": 1,
          "description": "Notification events"
        }
      }
    },
    "audit": {
      "type": "object",
      "required": ["enabled", "storage_path", "tracked_events"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable audit trail"
        },
        "immutable_storage": {
          "type": "boolean",
          "description": "Use immutable storage"
        },
        "storage_path": {
          "type": "string",
          "description": "Path for audit storage"
        },
        "retention_days": {
          "type": "integer",
          "minimum": 1,
          "description": "Retention period in days"
        },
        "tracked_events": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Events to track"
        },
        "audit_format": {
          "type": "object",
          "description": "Format for audit entries"
        }
      }
    },
    "rollback": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable rollback capability"
        },
        "automatic_rollback": {
          "type": "boolean",
          "description": "Enable automatic rollback"
        },
        "require_approval": {
          "type": "boolean",
          "description": "Require approval for rollback"
        },
        "conditions": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "Conditions for rollback"
        },
        "rollback_steps": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "Steps for rollback"
        }
      }
    },
    "changelog": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["ts", "by", "version", "change"],
        "properties": {
          "ts": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp"
          },
          "by": {
            "type": "string",
            "description": "Author"
          },
          "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "Version"
          },
          "change": {
            "type": "string",
            "description": "Description of change"
          }
        }
      },
      "description": "Configuration changelog"
    }
  }
}
