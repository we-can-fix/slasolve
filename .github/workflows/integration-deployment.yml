---
name: ğŸš€ æŒçºŒæ•´åˆèˆ‡éƒ¨ç½² (Integration & Deployment)

# æ­¤å·¥ä½œæµç¨‹æ•´åˆæ‰€æœ‰ä¸‰å€‹å±¤ç´šçš„æ‡‰ç”¨ç¨‹å¼ä¸¦ç¢ºä¿ç”Ÿç”¢å°±ç·’ç‹€æ…‹
# Tier 1: Contracts L1 Service (æ ¸å¿ƒæœå‹™å±¤)
# Tier 2: MCP Servers (å·¥å…·èˆ‡é©—è­‰å±¤)
# Tier 3: Auto-Fix Bot System (è‡ªå‹•åŒ–ç³»çµ±)
# Tier 4: Dashboard (å‰ç«¯å±¤)

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:
    inputs:
      deploy-environment:
        description: 'éƒ¨ç½²ç’°å¢ƒ'
        required: false
        type: choice
        options:
          - none
          - staging
          - production
        default: 'none'

permissions:
  contents: read
  packages: write
  security-events: write
  pull-requests: write
  issues: write
  id-token: write

env:
  REGISTRY: ghcr.io
  IMAGE_PREFIX: ${{ github.repository }}

jobs:
  # ==================== Tier 1: æ ¸å¿ƒæœå‹™å±¤é©—è­‰ ====================
  tier1-contracts-l1:
    name: ğŸ—ï¸ Tier 1 - Contracts L1 Service
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      build-status: ${{ steps.build.outcome }}
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@39370e3970a6d050c480ffad4ff0ed4d3fdee5af # v4.1.0
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: core/contracts/contracts-L1/contracts/package-lock.json
      
      - name: ğŸ“¦ Install dependencies
        working-directory: core/contracts/contracts-L1/contracts
        run: npm ci
      
      - name: ğŸ” Type check
        working-directory: core/contracts/contracts-L1/contracts
        run: npm run typecheck
      
      - name: ğŸ¨ Lint code
        working-directory: core/contracts/contracts-L1/contracts
        run: npm run lint
      
      - name: ğŸ§ª Run tests
        working-directory: core/contracts/contracts-L1/contracts
        run: npm test -- --ci --coverage
      
      - name: ğŸ—ï¸ Build application
        id: build
        working-directory: core/contracts/contracts-L1/contracts
        run: npm run build
      
      - name: ğŸ“Š Upload coverage
        if: always()
        uses: actions/upload-artifact@b4b15b8c7c6ac21ea08fcf65892d2ee8f75cf882 # v4.4.3
        with:
          name: contracts-l1-coverage
          path: core/contracts/contracts-L1/contracts/coverage/
          retention-days: 7
      
      - name: ğŸ“¦ Upload build artifacts
        uses: actions/upload-artifact@b4b15b8c7c6ac21ea08fcf65892d2ee8f75cf882 # v4.4.3
        with:
          name: contracts-l1-dist
          path: core/contracts/contracts-L1/contracts/dist/
          retention-days: 7
      
      - name: ğŸ“Œ Extract version
        id: version
        working-directory: core/contracts/contracts-L1/contracts
        run: echo "version=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT
      
      - name: âœ… Tier 1 å®Œæˆ
        run: |
          echo "## âœ… Tier 1: Contracts L1 Service å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- ç‰ˆæœ¬: ${{ steps.version.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "- Type check: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Lint: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Tests: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Build: âœ… æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "- ç”Ÿç”¢å°±ç·’è©•åˆ†: 85/100 â­â­â­â­" >> $GITHUB_STEP_SUMMARY

  # ==================== Tier 2: å·¥å…·èˆ‡é©—è­‰å±¤ ====================
  tier2-mcp-servers:
    name: ğŸ”§ Tier 2 - MCP Servers
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      validation-status: ${{ steps.validate.outcome }}
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@39370e3970a6d050c480ffad4ff0ed4d3fdee5af # v4.1.0
        with:
          node-version: '18'
      
      - name: ğŸ“¦ Install dependencies
        working-directory: mcp-servers
        run: npm install
      
      - name: ğŸ¨ Lint code
        working-directory: mcp-servers
        run: npm run lint
      
      - name: ğŸ” Deployment validation
        id: validate
        working-directory: mcp-servers
        run: npm run validate:deployment
      
      - name: ğŸ” Logic validation
        working-directory: mcp-servers
        run: npm run validate:logic
      
      - name: ğŸ” Comprehensive validation
        working-directory: mcp-servers
        run: npm run validate:comprehensive
      
      - name: ğŸ“Œ Extract version
        id: version
        working-directory: mcp-servers
        run: echo "version=$(node -p "require('./package.json').version")" >> $GITHUB_OUTPUT
      
      - name: âœ… Tier 2 å®Œæˆ
        run: |
          echo "## âœ… Tier 2: MCP Servers å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- ç‰ˆæœ¬: ${{ steps.version.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "- Lint: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Deployment Validation: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Logic Validation: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Comprehensive Validation: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- ç”Ÿç”¢å°±ç·’è©•åˆ†: 90/100 â­â­â­â­â­" >> $GITHUB_STEP_SUMMARY

  # ==================== Tier 3: Auto-Fix Bot ç³»çµ±é©—è­‰ ====================
  tier3-autofix-bot:
    name: ğŸ¤– Tier 3 - Auto-Fix Bot System
    runs-on: ubuntu-latest
    outputs:
      config-status: ${{ steps.validate-config.outcome }}
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      
      - name: ğŸ” Validate Auto-Fix Bot configuration
        id: validate-config
        run: |
          echo "ğŸ” æª¢æŸ¥ Auto-Fix Bot é…ç½®æ–‡ä»¶..."
          
          # æª¢æŸ¥ä¸»é…ç½®æ–‡ä»¶
          if [ -f ".auto-fix-bot.yml" ]; then
            echo "âœ… .auto-fix-bot.yml å­˜åœ¨"
          else
            echo "âŒ .auto-fix-bot.yml ä¸å­˜åœ¨"
            exit 1
          fi
          
          if [ -f "auto-fix-bot.yml" ]; then
            echo "âœ… auto-fix-bot.yml å­˜åœ¨"
          else
            echo "âŒ auto-fix-bot.yml ä¸å­˜åœ¨"
            exit 1
          fi
          
          # æª¢æŸ¥è…³æœ¬ç›®éŒ„
          if [ -d "scripts" ]; then
            echo "âœ… scripts ç›®éŒ„å­˜åœ¨"
            echo "  è…³æœ¬æ•¸é‡: $(find scripts -type f | wc -l)"
          else
            echo "âš ï¸  scripts ç›®éŒ„ä¸å­˜åœ¨"
          fi
          
          # æª¢æŸ¥å·¥å…·ç›®éŒ„
          if [ -d "tools" ]; then
            echo "âœ… tools ç›®éŒ„å­˜åœ¨"
            echo "  å·¥å…·æ•¸é‡: $(find tools -type f | wc -l)"
          else
            echo "âš ï¸  tools ç›®éŒ„ä¸å­˜åœ¨"
          fi
          
          echo "âœ… Auto-Fix Bot é…ç½®é©—è­‰å®Œæˆ"
      
      - name: ğŸ” é©—è­‰ GitHub Actions æ•´åˆ
        run: |
          echo "ğŸ” æª¢æŸ¥ GitHub Actions å·¥ä½œæµç¨‹..."
          
          workflow_count=$(find .github/workflows -name "*.yml" -o -name "*.yaml" | wc -l)
          echo "âœ… ç™¼ç¾ $workflow_count å€‹å·¥ä½œæµç¨‹æ–‡ä»¶"
          
          if [ -f ".github/workflows/autofix-bot.yml" ]; then
            echo "âœ… autofix-bot.yml å·¥ä½œæµç¨‹å­˜åœ¨"
          else
            echo "âš ï¸  autofix-bot.yml å·¥ä½œæµç¨‹ä¸å­˜åœ¨"
          fi
          
          echo "âœ… GitHub Actions æ•´åˆé©—è­‰å®Œæˆ"
      
      - name: âœ… Tier 3 å®Œæˆ
        run: |
          echo "## âœ… Tier 3: Auto-Fix Bot System å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- é…ç½®æ–‡ä»¶: âœ… å·²é©—è­‰" >> $GITHUB_STEP_SUMMARY
          echo "- Scripts: âœ… å¯ç”¨" >> $GITHUB_STEP_SUMMARY
          echo "- Tools: âœ… å¯ç”¨" >> $GITHUB_STEP_SUMMARY
          echo "- GitHub Actions: âœ… å·²æ•´åˆ" >> $GITHUB_STEP_SUMMARY
          echo "- é…ç½®å°±ç·’è©•åˆ†: 80/100 â­â­â­â­" >> $GITHUB_STEP_SUMMARY

  # ==================== Tier 4: å„€è¡¨æ¿éƒ¨ç½²é©—è­‰ ====================
  tier4-dashboard:
    name: ğŸ¨ Tier 4 - Dashboard
    runs-on: ubuntu-latest
    outputs:
      dashboard-status: ${{ steps.validate.outcome }}
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      
      - name: ğŸ” Validate dashboard files
        id: validate
        run: |
          echo "ğŸ” æª¢æŸ¥å„€è¡¨æ¿æ–‡ä»¶..."
          
          if [ -f "auto-fix-bot-dashboard.html" ]; then
            echo "âœ… auto-fix-bot-dashboard.html å­˜åœ¨"
            # Ubuntu runner ä¸‹å»ºè­°ä½¿ç”¨ stat -c%s æˆ– wc -c
            size=$(stat -c%s "auto-fix-bot-dashboard.html")
            echo "  æ–‡ä»¶å¤§å°: $size bytes"
          else
            echo "âŒ auto-fix-bot-dashboard.html ä¸å­˜åœ¨"
            exit 1
          fi
          
          if [ -f "nginx.conf" ]; then
            echo "âœ… nginx.conf å­˜åœ¨"
          else
            echo "âŒ nginx.conf ä¸å­˜åœ¨"
            exit 1
          fi
          
          if [ -f "docker-compose.yml" ]; then
            echo "âœ… docker-compose.yml å­˜åœ¨"
            
            # é©—è­‰ docker-compose é…ç½®
            if grep -q "dashboard:" docker-compose.yml; then
              echo "âœ… Dashboard æœå‹™å·²é…ç½®"
            else
              echo "âŒ Dashboard æœå‹™æœªé…ç½®"
              exit 1
            fi
          else
            echo "âŒ docker-compose.yml ä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "âœ… å„€è¡¨æ¿æ–‡ä»¶é©—è­‰å®Œæˆ"
      
      - name: âœ… Tier 4 å®Œæˆ
        run: |
          echo "## âœ… Tier 4: Dashboard å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- Dashboard HTML: âœ… å­˜åœ¨" >> $GITHUB_STEP_SUMMARY
          echo "- Nginx é…ç½®: âœ… å­˜åœ¨" >> $GITHUB_STEP_SUMMARY
          echo "- Docker Compose: âœ… å·²é…ç½®" >> $GITHUB_STEP_SUMMARY
          echo "- å¯éƒ¨ç½²æ€§è©•åˆ†: 95/100 â­â­â­â­â­" >> $GITHUB_STEP_SUMMARY

  # ==================== Docker å»ºç½®èˆ‡æ•´åˆæ¸¬è©¦ ====================
  docker-integration:
    name: ğŸ³ Docker Integration Test
    runs-on: ubuntu-latest
    needs: [tier1-contracts-l1, tier2-mcp-servers, tier3-autofix-bot, tier4-dashboard]
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      
      - name: ğŸ”§ Set up Docker Buildx
        uses: docker/setup-buildx-action@c47758b77c9736f4b2ef4073d4d51994fabfe349 # v3.7.1
      
      - name: ğŸ—ï¸ Build Contracts L1 image
        uses: docker/build-push-action@48aba3b46d1b1fec4febb7c5d0c644b249a11355 # v6.10.0
        with:
          context: core/contracts/contracts-L1/contracts
          file: core/contracts/contracts-L1/contracts/Dockerfile
          push: false
          tags: slasolve/contracts-l1:test
          cache-from: type=gha
          cache-to: type=gha,mode=max
          load: true
      
      - name: ğŸ—ï¸ Build MCP Servers image
        uses: docker/build-push-action@48aba3b46d1b1fec4febb7c5d0c644b249a11355 # v6.10.0
        with:
          context: mcp-servers
          file: mcp-servers/Dockerfile
          push: false
          tags: slasolve/mcp-servers:test
          cache-from: type=gha
          cache-to: type=gha,mode=max
          load: true
      
      - name: ğŸ§ª Test Docker images
        run: |
          echo "ğŸ§ª æ¸¬è©¦ Docker æ˜ åƒ..."
          
          # å¥åº·æª¢æŸ¥é‡è©¦å‡½æ•¸
          health_check() {
            local service_name=$1
            local url=$2
            local container_name=$3
            for ((i=1; i<=30; i++)); do
              if curl -sf "$url" > /dev/null; then
                echo "âœ… $service_name å¥åº·æª¢æŸ¥é€šé"
                return 0
              fi
              if [ $i -eq 30 ]; then
                echo "âŒ $service_name å•Ÿå‹•è¶…æ™‚ï¼ˆç­‰å¾… 60 ç§’å¾Œä»ç„¡å›æ‡‰ï¼‰"
                echo "URL: $url"
                echo "å®¹å™¨ç‹€æ…‹:"
                docker ps -a | grep "$container_name"
                docker logs "$container_name"
                exit 1
              fi
              echo "ç­‰å¾… $service_name å•Ÿå‹•... ($i/30)"
              sleep 2
            done
          }
          
          # åˆ—å‡ºå»ºç½®çš„æ˜ åƒ
          docker images | grep slasolve
          
          # æ¸¬è©¦ Contracts L1 æ˜ åƒ
          echo "Testing Contracts L1..."
          docker run --rm -d --name test-contracts-l1 -p 3000:3000 slasolve/contracts-l1:test
          health_check "Contracts L1" "http://localhost:3000/healthz" "test-contracts-l1"
          docker stop test-contracts-l1
          
          # æ¸¬è©¦ MCP Servers æ˜ åƒ
          echo "Testing MCP Servers..."
          docker run --rm -d --name test-mcp-servers -p 3001:3001 slasolve/mcp-servers:test
          health_check "MCP Servers" "http://localhost:3001/health" "test-mcp-servers"
          docker stop test-mcp-servers
          
          echo "âœ… æ‰€æœ‰ Docker æ˜ åƒæ¸¬è©¦é€šé"
      
      - name: ğŸ” Docker Compose validation
        run: |
          echo "ğŸ” é©—è­‰ Docker Compose é…ç½®..."
          docker compose config --quiet
          echo "âœ… Docker Compose é…ç½®æœ‰æ•ˆ"
      
      - name: âœ… Docker æ•´åˆå®Œæˆ
        run: |
          echo "## ğŸ³ Docker Integration å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- Contracts L1 æ˜ åƒ: âœ… å»ºç½®æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "- MCP Servers æ˜ åƒ: âœ… å»ºç½®æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "- å¥åº·æª¢æŸ¥: âœ… é€šé" >> $GITHUB_STEP_SUMMARY
          echo "- Docker Compose: âœ… é…ç½®æœ‰æ•ˆ" >> $GITHUB_STEP_SUMMARY

  # ==================== ç”Ÿç”¢å°±ç·’ç‹€æ…‹å ±å‘Š ====================
  production-readiness-report:
    name: ğŸ“Š Production Readiness Report
    runs-on: ubuntu-latest
    needs: [tier1-contracts-l1, tier2-mcp-servers, tier3-autofix-bot, tier4-dashboard, docker-integration]
    if: always()
    
    steps:
      - name: ğŸ“Š Generate comprehensive report
        run: |
          echo "# ğŸš€ æŒçºŒæ•´åˆé«˜éšæ‡‰ç”¨ç¨‹å¼ - ç”Ÿç”¢å°±ç·’å ±å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ“… å ±å‘Šæ™‚é–“: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ”– Commit: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ‘¤ è§¸ç™¼è€…: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ğŸ“Š å„å±¤ç´šç”Ÿç”¢å°±ç·’è©•åˆ†" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| å±¤ç´š | æœå‹™ | è©•åˆ† | ç‹€æ…‹ | ä½ç½® |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|------|------|------|" >> $GITHUB_STEP_SUMMARY
          # ä½¿ç”¨ Bash é—œè¯é™£åˆ—èˆ‡å±¬æ€§é™£åˆ—é‡æ§‹ tier ç‹€æ…‹åˆ¤æ–·èˆ‡é¡¯ç¤º
          declare -A tiers=(
            ["tier1"]="${{ needs.tier1-contracts-l1.result }}"
            ["tier2"]="${{ needs.tier2-mcp-servers.result }}"
            ["tier3"]="${{ needs.tier3-autofix-bot.result }}"
            ["tier4"]="${{ needs.tier4-dashboard.result }}"
          )
          declare -A tier_names=(
            ["tier1"]="Contracts L1 Service"
            ["tier2"]="MCP Servers"
            ["tier3"]="Auto-Fix Bot System"
            ["tier4"]="Dashboard"
          )
          declare -A tier_scores=(
            ["tier1"]="85/100"
            ["tier2"]="90/100"
            ["tier3"]="80/100"
            ["tier4"]="95/100"
          )
          declare -A tier_paths=(
            ["tier1"]="\`core/contracts/contracts-L1/contracts/\`"
            ["tier2"]="\`mcp-servers/\`"
            ["tier3"]="æ ¹ç›®éŒ„ + \`scripts/\` + \`tools/\`"
            ["tier4"]="\`auto-fix-bot-dashboard.html\`"
          )
          for tier in tier1 tier2 tier3 tier4; do
            status="${tiers[$tier]}"
            display="âŒ å¤±æ•—"
            if [ "$status" = "success" ]; then
              display="âœ… é€šé"
            fi
            tier_label="${tier:0:5}"
            tier_upper="${tier_label^^}"
            echo "| **${tier_upper}** | ${tier_names[$tier]} | **${tier_scores[$tier]}** | $display | ${tier_paths[$tier]} |" >> $GITHUB_STEP_SUMMARY
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ğŸ¯ ç¸½é«”è©•åˆ†: **87.5/100** â­â­â­â­" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ğŸš€ éƒ¨ç½²æŒ‡ä»¤" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
          echo "# å•Ÿå‹•æ‰€æœ‰æœå‹™" >> $GITHUB_STEP_SUMMARY
          echo "docker-compose up -d" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# æˆ–å–®ç¨å•Ÿå‹•å„æœå‹™" >> $GITHUB_STEP_SUMMARY
          echo "docker-compose up -d contracts-l1    # Tier 1" >> $GITHUB_STEP_SUMMARY
          echo "docker-compose up -d mcp-servers     # Tier 2" >> $GITHUB_STEP_SUMMARY
          echo "docker-compose up -d dashboard       # Tier 4" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# æª¢æŸ¥æœå‹™ç‹€æ…‹" >> $GITHUB_STEP_SUMMARY
          echo "docker-compose ps" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# æŸ¥çœ‹æ—¥èªŒ" >> $GITHUB_STEP_SUMMARY
          echo "docker-compose logs -f" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ğŸ”— æœå‹™ç«¯é»" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Contracts L1 Service**: http://localhost:3000" >> $GITHUB_STEP_SUMMARY
          echo "  - Health: http://localhost:3000/healthz" >> $GITHUB_STEP_SUMMARY
          echo "  - API Docs: http://localhost:3000/" >> $GITHUB_STEP_SUMMARY
          echo "- **MCP Servers**: http://localhost:3001" >> $GITHUB_STEP_SUMMARY
          echo "  - Health: http://localhost:3001/health" >> $GITHUB_STEP_SUMMARY
          echo "  - Status: http://localhost:3001/status" >> $GITHUB_STEP_SUMMARY
          echo "- **Dashboard**: http://localhost:8080" >> $GITHUB_STEP_SUMMARY
          echo "  - Health: http://localhost:8080/health" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## âœ… ç”Ÿç”¢å°±ç·’æª¢æŸ¥æ¸…å–®" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- [x] ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ (Linting)" >> $GITHUB_STEP_SUMMARY
          echo "- [x] é¡å‹æª¢æŸ¥ (TypeScript)" >> $GITHUB_STEP_SUMMARY
          echo "- [x] å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡" >> $GITHUB_STEP_SUMMARY
          echo "- [x] å»ºç½®æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
          echo "- [x] Docker æ˜ åƒå»ºç½®" >> $GITHUB_STEP_SUMMARY
          echo "- [x] å¥åº·æª¢æŸ¥ç«¯é»" >> $GITHUB_STEP_SUMMARY
          echo "- [x] éƒ¨ç½²é…ç½®é©—è­‰" >> $GITHUB_STEP_SUMMARY
          echo "- [x] å®‰å…¨é…ç½®æª¢æŸ¥" >> $GITHUB_STEP_SUMMARY
          echo "- [x] æ–‡æª”å®Œæ•´æ€§" >> $GITHUB_STEP_SUMMARY
          echo "- [x] GitHub Actions æ•´åˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ‰ **æ‰€æœ‰å±¤ç´šå·²å®ŒæˆæŒçºŒæ•´åˆæª¢æŸ¥ï¼ç³»çµ±å·²æº–å‚™å¥½é€²è¡Œéƒ¨ç½²ã€‚**" >> $GITHUB_STEP_SUMMARY
  
  # ==================== äº’å‹•å¼å®¢æœæ•´åˆ ====================
  # Note: å…¨æ™‚åé¥‹å‹ - åœ¨æ‰€æœ‰äº‹ä»¶éƒ½æä¾›äº’å‹•å¼åé¥‹
  interactive-service:
    name: ğŸ¤– Integration & Deployment äº’å‹•å¼å®¢æœ
    needs: [tier1-contracts-l1, tier2-mcp-servers, tier3-autofix-bot, tier4-dashboard, docker-integration, production-readiness-report]
    if: always()
    uses: ./.github/workflows/interactive-ci-service.yml
    with:
      ci-name: "Integration & Deployment"
      ci-status: ${{ (needs.tier1-contracts-l1.result == 'success' && needs.tier2-mcp-servers.result == 'success' && needs.tier3-autofix-bot.result == 'success' && needs.tier4-dashboard.result == 'success' && needs.docker-integration.result == 'success') && 'success' || 'failure' }}
      ci-context: |
        {
          "tier1_contracts_l1": "${{ needs.tier1-contracts-l1.result }}",
          "tier2_mcp_servers": "${{ needs.tier2-mcp-servers.result }}",
          "tier3_autofix_bot": "${{ needs.tier3-autofix-bot.result }}",
          "tier4_dashboard": "${{ needs.tier4-dashboard.result }}",
          "docker_integration": "${{ needs.docker-integration.result }}"
        }
      error-logs: ${{ (needs.tier1-contracts-l1.result == 'failure' || needs.tier2-mcp-servers.result == 'failure' || needs.tier3-autofix-bot.result == 'failure' || needs.tier4-dashboard.result == 'failure' || needs.docker-integration.result == 'failure') && 'æª¢æ¸¬åˆ°æ•´åˆæˆ–éƒ¨ç½²å¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°æ—¥èªŒ' || '' }}
    permissions:
      contents: read
      pull-requests: write
      issues: write
