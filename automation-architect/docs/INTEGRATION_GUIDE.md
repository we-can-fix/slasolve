# Integration Guide
# é›†æˆæŒ‡å— - Automation Architect

## ç›®éŒ„ Table of Contents

1. [èˆ‡ SLASolve é›†æˆ](#èˆ‡-slasolve-é›†æˆ)
2. [GitHub Actions é›†æˆ](#github-actions-é›†æˆ)
3. [GitLab CI é›†æˆ](#gitlab-ci-é›†æˆ)
4. [Jenkins é›†æˆ](#jenkins-é›†æˆ)
5. [IDE æ’ä»¶é›†æˆ](#ide-æ’ä»¶é›†æˆ)
6. [Webhook é›†æˆ](#webhook-é›†æˆ)
7. [API å®¢æˆ¶ç«¯é›†æˆ](#api-å®¢æˆ¶ç«¯é›†æˆ)

---

## èˆ‡ SLASolve é›†æˆ

### 1. å®‰è£åˆ° SLASolve é …ç›®

```bash
cd slasolve
git submodule add https://github.com/we-can-fix/automation-architect.git automation-architect
git submodule update --init --recursive
```

### 2. é…ç½®é›†æˆ

åœ¨ SLASolve çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```yaml
# .slasolve.yml
automation_architect:
  enabled: true
  scenarios:
    - drone-systems
    - autonomous-driving
    - automation-iteration
  
  auto_fix:
    enabled: true
    auto_commit: false
    create_pr: true
  
  analysis:
    on_commit: true
    on_pr: true
    schedule: "0 2 * * *"
```

### 3. ä½¿ç”¨ç¤ºä¾‹

```python
from slasolve.automation_architect import AutomationArchitect

# å‰µå»ºå¯¦ä¾‹
architect = AutomationArchitect(
    scenario='drone-systems',
    config_path='.slasolve.yml'
)

# åŸ·è¡Œåˆ†æ
result = await architect.analyze_project()

# ç”Ÿæˆå ±å‘Š
report = architect.generate_slsa_report()
```

---

## GitHub Actions é›†æˆ

### åŸºæœ¬å·¥ä½œæµ

å‰µå»º `.github/workflows/code-analysis.yml`:

```yaml
name: Automated Code Analysis

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 2 * * *'

jobs:
  analyze:
    name: Code Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          submodules: recursive
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install Automation Architect
        run: |
          cd automation-architect
          pip install -r requirements.txt
      
      - name: Run Analysis
        run: |
          python automation-architect/core/orchestration/pipeline.py \
            --scenario drone-systems \
            --output reports/analysis.json
      
      - name: Upload Report
        uses: actions/upload-artifact@v3
        with:
          name: analysis-report
          path: reports/
      
      - name: Comment on PR
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const report = JSON.parse(fs.readFileSync('reports/analysis.json'));
            
            const comment = `## ğŸ¤– Automated Code Analysis Report
            
            **Total Issues:** ${report.total_issues}
            **Critical:** ${report.severity_counts.critical}
            **High:** ${report.severity_counts.high}
            **Medium:** ${report.severity_counts.warning}
            
            See full report in artifacts.`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
```

### é«˜ç´šå·¥ä½œæµï¼šè‡ªå‹•ä¿®å¾©

```yaml
name: Auto-Fix Issues

on:
  schedule:
    - cron: '0 2 * * 1'  # æ¯é€±ä¸€å‡Œæ™¨ 2 é»
  workflow_dispatch:

jobs:
  auto-fix:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          cd automation-architect
          pip install -r requirements.txt
      
      - name: Run Auto-Fix
        run: |
          python automation-architect/core/repair/rule_engine.py \
            --auto-apply \
            --create-pr
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: 'chore: auto-fix code issues'
          title: 'ğŸ¤– Automated Code Fixes'
          body: |
            This PR contains automated code fixes generated by Automation Architect.
            
            Please review the changes carefully before merging.
          branch: auto-fix/automated-fixes
          labels: automated, auto-fix
```

---

## GitLab CI é›†æˆ

å‰µå»º `.gitlab-ci.yml`:

```yaml
stages:
  - analyze
  - fix
  - report

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

cache:
  paths:
    - .cache/pip
    - automation-architect/.cache

code_analysis:
  stage: analyze
  image: python:3.10
  script:
    - cd automation-architect
    - pip install -r requirements.txt
    - python core/orchestration/pipeline.py --output ../reports/analysis.json
  artifacts:
    paths:
      - reports/
    reports:
      codequality: reports/codequality.json
  only:
    - merge_requests
    - main

security_scan:
  stage: analyze
  image: python:3.10
  script:
    - cd automation-architect
    - pip install -r requirements.txt
    - python core/analysis/security_scanner.py --output ../reports/security.json
  artifacts:
    paths:
      - reports/
  only:
    - merge_requests
    - main

auto_fix:
  stage: fix
  image: python:3.10
  script:
    - cd automation-architect
    - pip install -r requirements.txt
    - python core/repair/rule_engine.py --auto-apply
  only:
    - schedules
  when: manual

generate_report:
  stage: report
  image: python:3.10
  script:
    - python automation-architect/scripts/generate_report.py
  artifacts:
    paths:
      - reports/
    expire_in: 30 days
  only:
    - main
```

---

## Jenkins é›†æˆ

å‰µå»º `Jenkinsfile`:

```groovy
pipeline {
    agent any
    
    environment {
        PYTHON_VERSION = '3.10'
    }
    
    stages {
        stage('Setup') {
            steps {
                sh '''
                    python${PYTHON_VERSION} -m venv venv
                    . venv/bin/activate
                    pip install -r automation-architect/requirements.txt
                '''
            }
        }
        
        stage('Code Analysis') {
            parallel {
                stage('Static Analysis') {
                    steps {
                        sh '''
                            . venv/bin/activate
                            python automation-architect/core/analysis/static_analyzer.py \
                                --output reports/static.json
                        '''
                    }
                }
                
                stage('Security Scan') {
                    steps {
                        sh '''
                            . venv/bin/activate
                            python automation-architect/core/analysis/security_scanner.py \
                                --output reports/security.json
                        '''
                    }
                }
                
                stage('Performance Analysis') {
                    steps {
                        sh '''
                            . venv/bin/activate
                            python automation-architect/core/analysis/performance_analyzer.py \
                                --output reports/performance.json
                        '''
                    }
                }
            }
        }
        
        stage('Auto-Fix') {
            when {
                branch 'develop'
            }
            steps {
                sh '''
                    . venv/bin/activate
                    python automation-architect/core/repair/rule_engine.py \
                        --auto-apply
                '''
            }
        }
        
        stage('Generate Report') {
            steps {
                sh '''
                    . venv/bin/activate
                    python automation-architect/scripts/generate_report.py \
                        --format html \
                        --output reports/index.html
                '''
                
                publishHTML([
                    reportDir: 'reports',
                    reportFiles: 'index.html',
                    reportName: 'Analysis Report'
                ])
            }
        }
    }
    
    post {
        always {
            archiveArtifacts artifacts: 'reports/**/*', fingerprint: true
            junit 'reports/junit.xml'
        }
        
        failure {
            emailext(
                subject: "Build Failed: ${env.JOB_NAME} - ${env.BUILD_NUMBER}",
                body: "Check console output at ${env.BUILD_URL}",
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
    }
}
```

---

## IDE æ’ä»¶é›†æˆ

### VS Code é›†æˆ

å‰µå»º `.vscode/tasks.json`:

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Analyze Current File",
      "type": "shell",
      "command": "python",
      "args": [
        "automation-architect/core/orchestration/pipeline.py",
        "--file",
        "${file}"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Auto-Fix Current File",
      "type": "shell",
      "command": "python",
      "args": [
        "automation-architect/core/repair/rule_engine.py",
        "--file",
        "${file}",
        "--auto-apply"
      ],
      "problemMatcher": []
    }
  ]
}
```

### PyCharm é›†æˆ

å‰µå»ºå¤–éƒ¨å·¥å…·ï¼š

1. Settings â†’ Tools â†’ External Tools â†’ Add
2. åç¨±: "Automation Architect Analysis"
3. ç¨‹åº: `python`
4. åƒæ•¸: `automation-architect/core/orchestration/pipeline.py --file $FilePath$`
5. å·¥ä½œç›®éŒ„: `$ProjectFileDir$`

---

## Webhook é›†æˆ

### è¨­ç½® Webhook æœå‹™å™¨

```python
from fastapi import FastAPI, Request
from automation_architect.core.orchestration.pipeline import AnalysisPipeline

app = FastAPI()
pipeline = AnalysisPipeline()

@app.post("/webhook/github")
async def github_webhook(request: Request):
    """è™•ç† GitHub webhook"""
    payload = await request.json()
    
    if payload.get('action') == 'opened' or payload.get('action') == 'synchronize':
        # åˆ†æ PR
        pr_number = payload['pull_request']['number']
        repo = payload['repository']['full_name']
        
        result = await pipeline.analyze(
            code_path=f"/tmp/{repo}/{pr_number}",
            scenario='general'
        )
        
        # ç™¼é€è©•è«–åˆ° PR
        # ...
        
    return {"status": "ok"}

@app.post("/webhook/gitlab")
async def gitlab_webhook(request: Request):
    """è™•ç† GitLab webhook"""
    # é¡ä¼¼å¯¦ç¾
    pass
```

### é…ç½® GitHub Webhook

1. å€‰åº« Settings â†’ Webhooks â†’ Add webhook
2. Payload URL: `https://your-domain.com/webhook/github`
3. Content type: `application/json`
4. Events: Pull requests, Push
5. Secret: è¨­ç½®å¯†é‘°

---

## API å®¢æˆ¶ç«¯é›†æˆ

### Python å®¢æˆ¶ç«¯

```python
import asyncio
from automation_architect_client import AutomationArchitectClient

async def main():
    # å‰µå»ºå®¢æˆ¶ç«¯
    client = AutomationArchitectClient(
        api_url="https://automation-architect.example.com",
        api_token="your-token-here"
    )
    
    # åŸ·è¡Œåˆ†æ
    result = await client.analyze(
        code_path="/path/to/code",
        scenario="drone-systems",
        enable_repair=True
    )
    
    # æŸ¥çœ‹çµæœ
    print(f"Total issues: {result.total_issues}")
    print(f"Critical: {result.severity_counts['critical']}")
    
    # ç²å–è©³ç´°å ±å‘Š
    report = await client.get_report(result.analysis_id)
    
    # ä¸‹è¼‰å ±å‘Š
    await client.download_report(result.analysis_id, "report.html")

asyncio.run(main())
```

### JavaScript å®¢æˆ¶ç«¯

```javascript
import AutomationArchitectClient from 'automation-architect-client';

const client = new AutomationArchitectClient({
  apiUrl: 'https://automation-architect.example.com',
  apiToken: 'your-token-here'
});

// åŸ·è¡Œåˆ†æ
const result = await client.analyze({
  codePath: '/path/to/code',
  scenario: 'autonomous-driving',
  enableRepair: true
});

console.log(`Total issues: ${result.totalIssues}`);
console.log(`Critical: ${result.severityCounts.critical}`);

// ç²å–å ±å‘Š
const report = await client.getReport(result.analysisId);
```

### REST API èª¿ç”¨

```bash
# å•Ÿå‹•åˆ†æ
curl -X POST https://api.automation-architect.com/v1/analyze \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "code_path": "/path/to/code",
    "scenario": "drone-systems",
    "enable_repair": true
  }'

# æŸ¥è©¢çµæœ
curl -X GET https://api.automation-architect.com/v1/analysis/{id} \
  -H "Authorization: Bearer your-token"

# ä¸‹è¼‰å ±å‘Š
curl -X GET https://api.automation-architect.com/v1/analysis/{id}/report \
  -H "Authorization: Bearer your-token" \
  -o report.html
```

---

## Pre-commit Hooks é›†æˆ

å‰µå»º `.pre-commit-config.yaml`:

```yaml
repos:
  - repo: local
    hooks:
      - id: automation-architect-analysis
        name: Automation Architect Analysis
        entry: python automation-architect/core/orchestration/pipeline.py
        language: python
        types: [python]
        pass_filenames: true
        args: [--quick-check]
      
      - id: automation-architect-security
        name: Security Scan
        entry: python automation-architect/core/analysis/security_scanner.py
        language: python
        types: [python]
        pass_filenames: true
        args: [--fail-on-critical]
```

å®‰è£ï¼š

```bash
pip install pre-commit
pre-commit install
```

---

## æŒçºŒç›£æ§é›†æˆ

### Datadog é›†æˆ

```python
from datadog import initialize, statsd

# åˆå§‹åŒ–
initialize(
    api_key='your-api-key',
    app_key='your-app-key'
)

# ç™¼é€æŒ‡æ¨™
from automation_architect.core.orchestration.pipeline import AnalysisPipeline

class MonitoredPipeline(AnalysisPipeline):
    async def analyze(self, *args, **kwargs):
        statsd.increment('automation_architect.analysis.started')
        
        try:
            result = await super().analyze(*args, **kwargs)
            statsd.increment('automation_architect.analysis.completed')
            statsd.gauge('automation_architect.issues.total', len(result.issues))
            return result
        except Exception as e:
            statsd.increment('automation_architect.analysis.failed')
            raise
```

### New Relic é›†æˆ

```python
import newrelic.agent

newrelic.agent.initialize('newrelic.ini')

@newrelic.agent.background_task()
async def analyze_code():
    pipeline = AnalysisPipeline()
    result = await pipeline.analyze('/path/to/code')
    return result
```

---

## è‡ªå®šç¾©é›†æˆ

### å‰µå»ºè‡ªå®šç¾©åˆ†æå™¨

```python
from automation_architect.core.analysis.static_analyzer import StaticAnalyzer

class CustomDomainAnalyzer(StaticAnalyzer):
    """ç‰¹å®šé ˜åŸŸçš„è‡ªå®šç¾©åˆ†æå™¨"""
    
    def __init__(self, domain_rules):
        super().__init__()
        self.domain_rules = domain_rules
    
    async def analyze(self, code_path, **kwargs):
        # å…ˆé‹è¡Œæ¨™æº–åˆ†æ
        result = await super().analyze(code_path, **kwargs)
        
        # æ·»åŠ é ˜åŸŸç‰¹å®šæª¢æŸ¥
        domain_issues = await self._check_domain_rules(code_path)
        result.issues.extend(domain_issues)
        
        return result
    
    async def _check_domain_rules(self, code_path):
        """å¯¦ç¾é ˜åŸŸç‰¹å®šè¦å‰‡"""
        issues = []
        # è‡ªå®šç¾©é‚è¼¯
        return issues
```

### å‰µå»ºè‡ªå®šç¾©ä¿®å¾©å™¨

```python
from automation_architect.core.repair.rule_engine import RuleEngine, RepairRule

class CustomRepairEngine(RuleEngine):
    """è‡ªå®šç¾©ä¿®å¾©å¼•æ“"""
    
    def __init__(self):
        super().__init__()
        self._load_custom_rules()
    
    def _load_custom_rules(self):
        """åŠ è¼‰è‡ªå®šç¾©è¦å‰‡"""
        self.add_rule(RepairRule(
            name='custom-pattern-fix',
            pattern=r'custom_pattern',
            replacement='improved_pattern',
            description='Fix custom patterns',
            auto_apply=True
        ))
```

---

## åƒè€ƒè³‡æ–™ References

- [API æ–‡æª”](API.md)
- [éƒ¨ç½²æŒ‡å—](DEPLOYMENT.md)
- [é …ç›® README](../README.md)
- [GitHub Actions æ–‡æª”](https://docs.github.com/actions)
- [GitLab CI æ–‡æª”](https://docs.gitlab.com/ee/ci/)

---

**ç‰ˆæœ¬ Version**: 2.0.0  
**æœ€å¾Œæ›´æ–° Last Updated**: 2025-11-25
