# docs/governance_matrix.yaml
# 治理邊界定義與責任矩陣

version: "1.0"
last_updated: "2025-11-26"

# 模組責任矩陣
responsibility_matrix:
  flight_controller:
    owner: "autonomy_team"
    maintainers: ["alice@company.com", "bob@company.com"]
    role: "flight_control"
    sla:
      availability: "99.9%"
      response_time_ms: 10
      error_rate: "< 0.1%"
    dependencies:
      - sensor_fusion
      - safety_monitor
    api_version: "2.0"
    language: "C++"
    
  sensor_fusion:
    owner: "perception_team"
    maintainers: ["charlie@company.com"]
    role: "sensor_integration"
    sla:
      availability: "99.5%"
      response_time_ms: 50
      error_rate: "< 0.5%"
    dependencies: []
    api_version: "1.5"
    language: "C++"
    
  safety_monitor:
    owner: "safety_team"
    maintainers: ["diana@company.com", "eve@company.com"]
    role: "safety_enforcement"
    sla:
      availability: "99.99%"
      response_time_ms: 5
      error_rate: "< 0.01%"
    dependencies:
      - flight_controller
      - sensor_fusion
    api_version: "3.0"
    language: "Python"

# API 邊界定義
api_boundaries:
  flight_controller_api:
    endpoint: "/api/v2/flight/control"
    methods:
      - method: "POST"
        path: "/command"
        input_schema:
          type: "object"
          properties:
            target_altitude:
              type: "number"
              description: "目標高度（公尺）"
            target_velocity:
              type: "array"
              items: { type: "number" }
              description: "目標速度向量 [vx, vy, vz]"
        output_schema:
          type: "object"
          properties:
            motor_commands:
              type: "array"
              items: { type: "number" }
            status:
              type: "string"
              enum: ["executing", "completed", "error"]
        error_codes:
          400: "Invalid input parameters"
          503: "Service unavailable"
          
  safety_monitor_api:
    endpoint: "/api/v3/safety/check"
    methods:
      - method: "POST"
        path: "/validate"
        input_schema:
          type: "object"
          properties:
            current_state:
              type: "object"
            control_command:
              type: "object"
        output_schema:
          type: "object"
          properties:
            is_safe:
              type: "boolean"
            violation_reason:
              type: "string"

# 錯誤分類與處理策略
error_handling:
  sensor_error:
    severity: "HIGH"
    action: "fallback_to_last_known_state"
    retry_policy: "exponential_backoff"
    max_retries: 3
    
  control_error:
    severity: "CRITICAL"
    action: "emergency_landing"
    retry_policy: "none"
    max_retries: 0
    
  safety_violation:
    severity: "CRITICAL"
    action: "trigger_emergency_protocol"
    retry_policy: "none"
    max_retries: 0

# 版本兼容性矩陣
compatibility_matrix:
  python_versions: ["3.8", "3.9", "3.10", "3.11", "3.12"]
  ros2_versions: ["humble", "iron", "jazzy"]
  os_platforms: ["ubuntu_20.04", "ubuntu_22.04", "ubuntu_24.04"]
  cpp_standards: ["C++17", "C++20"]

# 測試覆蓋率要求
test_requirements:
  unit_test_coverage: ">= 80%"
  integration_test_coverage: ">= 70%"
  safety_critical_coverage: ">= 95%"
  
# 安全與審計
security_requirements:
  authentication: "OAuth2"
  encryption: "TLS 1.3"
  audit_logging: "enabled"
  penetration_testing: "quarterly"
