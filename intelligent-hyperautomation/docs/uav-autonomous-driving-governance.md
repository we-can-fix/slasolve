# 無人機 / 自動駕駛 核心規範（平台中立、可移植）

## 目的

為 UAV（無人機）與 AD（自動駕駛）軟體系統提供治理與驗證準則，落實安全、合規、可追溯與最小權限。

## 適用範圍

- **應用對象**：聊天代理、運維機器人、自動化執行器
- **適用階段**：原始碼提交、CI、執行階段准入

## 治理原則

### 1. 禁止虛擬操作
- 不宣稱已執行任何外部操作
- 所有憑證、雜湊、簽章須可驗證
- 雜湊需於 CI 中計算，不生成虛假憑證或下載連結

### 2. 少問即做（最小互動原則）
- **低風險操作**：直接執行（如讀取配置、查詢狀態）
- **中風險操作**：試跑模式驗證（如部署到測試環境）
- **高風險操作**：一次確認後執行（如生產部署、設備控制）

### 3. 架構與輸出標準
- **一次性完整輸出**：避免待補項目，結構嚴格完整
- **無未知欄位**：Kubernetes 1.30 API 對齊
- **安全雜湊**：使用 SHA3-512 與 BLAKE3 雙重雜湊

### 4. 模式控制
- **深度執行任務模式**：每次輸出包含以下四個部分
  - Result（產物）
  - Validation（驗證）
  - Rollback（回滾）
  - Required Inputs（必要輸入）

## UAV/AD 通用策略模組（平台中立）

### 安全策略

#### 最小權限原則
- 服務帳號僅獲得必要權限
- RBAC 策略精確定義
- 密鑰存取僅限必要範圍

#### 設備指令白名單
- 飛控/車控 API 僅允許已審核指令集
- 危險操作需要額外授權
- 指令審計與追溯

#### 遙控/自動切換保護
- 手動優先權保留
- 緊急制動介面
- 緊急降落/停車機制

### 合規與審計

#### 審計鏈
- **時間戳**：所有操作記錄精確時間
- **版本追蹤**：每次變更記錄版本號
- **雙重雜湊**：SHA3-512 + BLAKE3 確保完整性
- **不可變記錄**：操作記錄採用 append-only 模式

#### 供應鏈透明
- **SBOM**：完整的軟體物料清單
- **簽章**：支援 SLSA/Cosign 簽章驗證
- **依賴追溯**：第三方依賴可追溯來源

### 驗證與准入

#### 乾跑/模擬
- **HIL/SIL 模式**：硬體在環/軟體在環測試必須通過
- **實車/實機前覆核**：需要兩人審核確認
- **模擬環境驗證**：在安全環境中完整測試

#### 地理限制
- **地理圍欄**：預定義安全操作區域
- **禁飛區/限速區**：自動識別與避讓
- **配置可審核與回滾**：所有地理限制配置可追溯

#### 任務級風險分級
- **低風險（L0-L2）**：試跑後自動執行
- **中風險（L3）**：需要一次人工確認
- **高風險（L4-L5）**：需要多重審核與批准

### 監控與韌性

#### 遙測資料
必須上報的關鍵指標：
- 位置（GPS/GNSS）
- 速度與加速度
- 姿態（俯仰、翻滾、偏航）
- 電量與電壓
- 溫度與濕度
- 通訊狀態

#### 異常處理
自動進入安全模式的觸發條件：
- **失聯**：通訊中斷超過閾值時間
- **感測器故障**：關鍵感測器失效
- **路徑偏離**：偏離預定路線超過安全距離
- **電量不足**：低於安全閾值
- **環境異常**：極端天氣或障礙物檢測

#### 升級策略
- **全量版本重發**：不允許增量補件
- **灰度發布**：逐步擴大影響範圍
- **快速回滾**：出現問題立即回退到穩定版本

## Kubernetes/GitOps 可移植落地

### 命名與標籤規範

#### 標準命名空間標籤
```yaml
metadata:
  labels:
    namespace.io/managed-by: "platform-team"
    namespace.io/domain: "uav" # 或 "ad"
    namespace.io/team: "robotics"
    namespace.io/environment: "production"
    namespace.io/region: "asia-east1"
    namespace.io/lifecycle: "stable"
```

#### UAV/AD 特定標籤
```yaml
metadata:
  labels:
    uav.io/system: "uav"              # 或 "ad"
    uav.io/safety-level: "L4"         # L0-L5 自動化等級
    uav.io/risk-category: "high"      # low/medium/high
    uav.io/geo-fence-enabled: "true"
    uav.io/emergency-stop: "enabled"
```

### 準入控制

#### Gatekeeper/OPA
- 策略驗證：標籤完整性、命名規範、資源限制
- 地理圍欄驗證：配置有效性、區域定義
- 風險等級檢查：高風險操作需額外審批

#### Conftest
- CI 中強制策略驗證
- 阻止不合規配置提交
- 生成驗證報告

### 部署流程

#### GitOps 整合
- **ArgoCD/Flux 任一**：選擇適合的 GitOps 工具
- **Server-side 驗證**：嚴格模式，禁止未知欄位
- **聲明式管理**：所有配置以 Git 為單一事實來源

#### 變更管理
- **版本標籤**：每次變更打 tag
- **審計記錄**：記錄誰、何時、為何變更
- **自動化測試**：變更前自動執行測試套件

## 實施檢查清單

### 部署前檢查
- [ ] 所有資源包含必要標籤
- [ ] 地理圍欄配置已驗證
- [ ] 風險等級正確分類
- [ ] SBOM 已生成並簽章
- [ ] 策略驗證通過（Conftest + Gatekeeper）
- [ ] 雙重雜湊已計算並記錄

### 執行階段監控
- [ ] 遙測資料正常上報
- [ ] 異常處理機制啟用
- [ ] 緊急停止按鈕可用
- [ ] 審計日誌持續記錄
- [ ] 資源使用在預期範圍

### 回滾準備
- [ ] 前一版本可快速恢復
- [ ] 回滾腳本已測試
- [ ] 回滾流程文檔完整
- [ ] 團隊知道回滾觸發條件

## 安全考量

### 多層防護
1. **准入層**：Gatekeeper/OPA 策略驗證
2. **執行層**：Runtime Security（如 Falco）
3. **網路層**：Network Policy 隔離
4. **資料層**：加密傳輸與存儲

### 最小曝險
- 最小權限原則（RBAC）
- 最小網路暴露（Network Policy）
- 最小資源配額（Resource Quota）
- 最小攻擊面（減少不必要服務）

### 持續合規
- 定期安全掃描
- 自動化合規檢查
- 漏洞修補流程
- 事件回應計畫

## 附錄：術語表

- **UAV**：Unmanned Aerial Vehicle（無人機）
- **AD**：Autonomous Driving（自動駕駛）
- **HIL**：Hardware-in-the-Loop（硬體在環）
- **SIL**：Software-in-the-Loop（軟體在環）
- **SLSA**：Supply-chain Levels for Software Artifacts
- **SBOM**：Software Bill of Materials（軟體物料清單）
- **RBAC**：Role-Based Access Control（基於角色的存取控制）
- **OPA**：Open Policy Agent（開放策略代理）

---

**版本**：2.0.0  
**最後更新**：2025-11-25  
**維護者**：Platform Team  
**審核者**：Safety & Compliance Team
