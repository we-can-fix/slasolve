# ============================================================================
# AUTO-FIX-BOT 配置文件 - Enterprise Code Intelligence Platform
# ============================================================================
# Project: SLASolve - Senior Automation Architect & Code Intelligence Engineer
# Version: 3.0.0 (Phase 1 Production Ready)
# Target: 月收入千萬美元企劃 - 第一版落地實作
# ============================================================================

# ==================== Metadata ====================
name: "Enterprise Code Intelligence Platform"
id: slasolve-auto-fix-bot
version: "3.0.0"
owner:
  team: platform-governance
  contacts: ["platform@islasolve.com"]
  approvers: ["tech-lead", "security-head"]

metadata:
  created_at: "2025-01-17T12:00:00Z"
  updated_at: "2025-11-25T14:39:00Z"
  labels: [auto-fix, governance, policy-enforcement, deep-validation, hyperautomation]
  compliance_tags: [slsa-l3, in-toto, audit-trail, axiom-free, enterprise-grade]
  project_structure: slasolve
  architecture_pattern: "智能超自動化治理架構"

description: >
  企業級自動化代碼分析與修復系統。整合深度可驗證模組、Policy Gate驗證、
  多層證據生成與審計追蹤。符合碎片化YAML提升為深度可驗證模組的治理原則。
  支援月收入千萬美元規模的自動化運營。

# ==================== Project Structure Mapping ====================
project_mapping:
  config_root: ".config"
  policies_root: ".config/conftest/policies"
  governance_root: ".governance"
  evidence_root: "root-evidence"
  schemas_root: "schemas"
  scripts_root: "scripts"
  templates_root: "templates"
  docs_root: "docs"
  mcp_servers_root: "mcp-servers"
  test_vectors_root: "test-vectors"
  autofix_root: ".autofix"
  agent_root: "agent"
  hyperautomation_root: "intelligent-hyperautomation"
  core_root: "advanced-system-src/core"

# ============================================================================
# 系統設置 (System Settings)
# ============================================================================
system:
  environment: "production"
  log_level: "INFO"
  max_workers: 16
  timeout: 300
  retry_attempts: 3
  
  # 性能配置
  performance:
    cache_enabled: true
    cache_ttl: 3600
    parallel_analysis: true
    incremental_analysis: true
    batch_size: 100
    
  # 監控配置
  monitoring:
    enabled: true
    metrics_port: 9090
    health_check_interval: 30
    alert_threshold: 0.8
    distributed_tracing: true

# ============================================================================
# 代碼分析配置 (Code Analysis Configuration)
# ============================================================================
code_analysis:
  enabled: true
  
  # 靜態分析
  static_analysis:
    enabled: true
    tools:
      - name: sonarqube
        enabled: true
        url: "http://sonarqube:9000"
        token: "${SONARQUBE_TOKEN}"
        quality_gate: true
      - name: pylint
        enabled: true
        config: ".pylintrc"
        min_score: 8.0
      - name: eslint
        enabled: true
        config: ".eslintrc.json"
        max_warnings: 0
      - name: clippy
        enabled: true
        deny_warnings: true
  
  # 動態分析
  dynamic_analysis:
    enabled: true
    tools:
      - name: valgrind
        enabled: true
        check_leaks: true
      - name: address_sanitizer
        enabled: true
      - name: thread_sanitizer
        enabled: true
      - name: memory_profiler
        enabled: true
  
  # 性能分析
  performance_analysis:
    enabled: true
    tools:
      - name: perf
        enabled: true
      - name: flamegraph
        enabled: true
      - name: py_spy
        enabled: true
      - name: benchmark
        enabled: true
        threshold: 0.95
  
  # 安全掃描
  security_scanning:
    enabled: true
    tools:
      - name: semgrep
        enabled: true
        rules: "p/security-audit"
        severity: ["ERROR", "WARNING"]
      - name: snyk
        enabled: true
        token: "${SNYK_TOKEN}"
        fail_on: "upgradable"
      - name: trivy
        enabled: true
        severity: "HIGH,CRITICAL"
        scan_types: ["vuln", "config", "secret"]
      - name: owasp_dependency_check
        enabled: true
        fail_on_cvss: 7.0

# ============================================================================
# 自動修復配置 (Auto Repair Configuration)
# ============================================================================
auto_repair:
  enabled: true
  
  # 修復規則
  repair_rules:
    - name: security_fixes
      enabled: true
      priority: 1
      auto_apply: false
      require_review: true
      categories:
        - sql_injection
        - xss
        - hardcoded_secrets
        - insecure_dependencies
    
    - name: code_style
      enabled: true
      priority: 3
      auto_apply: true
      require_review: false
      tools: ["black", "prettier", "gofmt", "rustfmt"]
    
    - name: performance_optimization
      enabled: true
      priority: 2
      auto_apply: false
      require_review: true
      thresholds:
        complexity: 10
        duplication: 0.05
        n_plus_one: true
    
    - name: dependency_updates
      enabled: true
      priority: 2
      auto_apply: false
      require_review: true
      strategies: ["minor", "patch"]
      exclude_major: true
  
  # 修復策略
  repair_strategies:
    - name: rule_based
      enabled: true
      rules_dir: ".autofix/rules"
      priority: 1
    
    - name: ast_based
      enabled: true
      transformations_dir: ".autofix/transformations"
      priority: 2
    
    - name: ml_based
      enabled: true
      model_path: "models/repair-model.pkl"
      confidence_threshold: 0.85
      priority: 3
  
  # 驗證配置
  verification:
    run_tests: true
    test_timeout: 300
    coverage_threshold: 0.85
    performance_check: true
    security_rescan: true
    rollback_on_failure: true

# ============================================================================
# CI/CD 集成 (CI/CD Integration)
# ============================================================================
cicd:
  enabled: true
  
  # Git 鉤子
  git_hooks:
    pre_commit:
      enabled: true
      timeout: 60
      checks: ["lint", "format", "security"]
    
    pre_push:
      enabled: true
      timeout: 120
      checks: ["test", "build", "audit"]
  
  # 工作流觸發
  workflow_triggers:
    - name: on_commit
      enabled: true
      branches: ["main", "develop"]
      actions: ["analyze", "test"]
    
    - name: on_pull_request
      enabled: true
      actions: ["opened", "synchronize"]
      checks: ["lint", "test", "security"]
    
    - name: on_schedule
      enabled: true
      cron: "0 2 * * *"  # 每天凌晨 2 點
      actions: ["full_scan", "dependency_audit"]

# ==================== Bot Configuration ====================
bot_config:
  enabled: true
  trigger_events: [push, pull_request, schedule, workflow_dispatch]
  auto_merge: false
  require_human_approval: true
  max_fixes_per_run: 10
  timeout: "30m"
  
  scopes:
    - name: deep-yaml-validation
      enabled: true
      paths: 
        - "templates/**/*.yaml"
        - "schemas/**/*.json"
        - ".config/**/*.yaml"
        - ".governance/**/*.yaml"
      
    - name: mcp-servers-validation
      enabled: true
      paths:
        - "mcp-servers/**/*.py"
        - "mcp-servers/**/*.json"
      
    - name: advanced-architecture-sync
      enabled: true
      paths:
        - "advanced-architecture/**/*"
        - "advanced-system-src/**/*"
        - "advanced-system-dist/**/*"
      
    - name: evidence-chain-validation
      enabled: true
      paths:
        - "root-evidence/**/*.json"
        - "attest-build-provenance-main/**/*"

# ==================== Fix Rules ====================
fix_rules:
  # 深度YAML驗證與修復
  - name: deep-yaml-schema-validation
    priority: critical
    enabled: true
    scope: deep-yaml-validation
    triggers:
      - file_pattern: "templates/**/*.yaml"
      - schema_violation: true
      - missing_required_fields: true
    
    actions:
      - name: schema-validation
        command: |
          python tools/validate_vectors.py ${FILE_PATH} \
            --schema schemas/template-schema.json \
            --output-format slsa \
            --evidence-dir root-evidence/validation/
        
      - name: auto-fix-missing-metadata
        when: "missing_fields.contains('metadata')"
        command: |
          python scripts/auto-fix/add_metadata.py ${FILE_PATH} \
            --template templates/metadata-template.yaml \
            --audit-trail root-evidence/audit/
        
      - name: generate-test-vectors
        when: "missing_fields.contains('test_vectors')"
        command: |
          python scripts/auto-fix/generate_test_vectors.py ${FILE_PATH} \
            --output test-vectors/${BASE_NAME}_vectors.json \
            --validate-against schemas/
  
  # MCP Servers 驗證與修復
  - name: mcp-servers-compliance
    priority: high
    enabled: true
    scope: mcp-servers-validation
    triggers:
      - file_pattern: "mcp-servers/**/*.py"
      - import_violations: true
      - missing_type_hints: true
    
    actions:
      - name: fix-imports
        command: |
          python scripts/auto-fix/fix_mcp_imports.py ${FILE_PATH} \
            --allowed-imports config/mcp-allowed-imports.json \
            --audit root-evidence/mcp-compliance/
        
      - name: add-type-hints
        command: |
          mypy --install-types --non-interactive ${FILE_PATH}
          python scripts/auto-fix/add_type_hints.py ${FILE_PATH}
  
  # Advanced Architecture 同步
  - name: architecture-consistency
    priority: medium
    enabled: true
    scope: advanced-architecture-sync
    triggers:
      - file_pattern: "advanced-system-src/**/*"
      - build_mismatch: true
    
    actions:
      - name: sync-to-dist
        command: |
          python scripts/build/sync_architecture.py \
            --src advanced-system-src/ \
            --dist advanced-system-dist/ \
            --verify-integrity \
            --evidence root-evidence/build-sync/
  
  # 證據鏈完整性檢查
  - name: evidence-chain-integrity
    priority: critical
    enabled: true
    scope: evidence-chain-validation
    triggers:
      - file_pattern: "root-evidence/**/*.json"
      - signature_missing: true
      - attestation_invalid: true
    
    actions:
      - name: verify-signatures
        command: |
          cosign verify-blob \
            --signature ${FILE_PATH}.sig \
            --certificate-identity-regexp ".*@islasolve\.com" \
            --certificate-oidc-issuer "https://token.actions.githubusercontent.com" \
            ${FILE_PATH}
        
      - name: regenerate-attestation
        when: "attestation_invalid == true"
        command: |
          python cross-layer-bridges/evidence-to-trust/generate_attestation.py \
            --input ${FILE_PATH} \
            --output ${FILE_PATH}.att \
            --format in-toto \
            --sign-key ${COSIGN_PRIVATE_KEY}

# ==================== Policy Gates ====================
policy_gates:
  # 前置檢查門
  - name: pre-validation-gate
    stage: pre-fix
    policies:
      - path: .config/conftest/policies/yaml-structure.rego
        engine: OPA
        required: true
        min_score: 100
      
      - path: .governance/security-policy.yaml
        engine: kyverno
        required: true
    
    failure_action: block
    notification:
      slack: "#islasolve-alerts"
      email: ["security@islasolve.com"]
  
  # 修復後驗證門
  - name: post-fix-validation-gate
    stage: post-fix
    policies:
      - path: .config/conftest/policies/deep-validation.rego
        engine: OPA
        required: true
        min_score: 95
      
      - path: schemas/complete-validation-schema.json
        engine: jsonschema
        required: true
    
    evidence_requirements:
      - sbom_generated: true
      - attestation_signed: true
      - provenance_complete: true
      - audit_trail_immutable: true
    
    failure_action: create_issue
    success_action: auto_approve

# ==================== Evidence Generation ====================
evidence_generation:
  enabled: true
  storage_backend: "root-evidence/"
  immutable: true
  
  generators:
    - name: sbom-generator
      trigger: "any_code_change"
      command: |
        syft packages ./ -o spdx-json \
          --file root-evidence/provenance/rag-provenance/sbom/auto-fix-sbom.json
        cosign sign-blob root-evidence/provenance/rag-provenance/sbom/auto-fix-sbom.json \
          --output-signature root-evidence/provenance/rag-provenance/sbom/auto-fix-sbom.json.sig
    
    - name: attestation-generator
      trigger: "fix_applied"
      command: |
        python cross-layer-bridges/evidence-to-trust/generate_attestation.py \
          --type auto-fix \
          --subject ${CHANGED_FILES} \
          --predicate-type "https://islasolve.com/auto-fix/v1" \
          --output root-evidence/attestation/auto-fix-attestation.json
    
    - name: provenance-generator
      trigger: "workflow_complete"
      command: |
        python scripts/generate_slsa_provenance.py \
          --workflow-run ${GITHUB_RUN_ID} \
          --output root-evidence/provenance/auto-fix-provenance.json \
          --format slsa-v1.0

# ==================== Notification Configuration ====================
notifications:
  channels:
    slack:
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#islasolve-auto-fix"
      mention_on_failure: ["@platform-team", "@security-team"]
    
    email:
      smtp_server: "${SMTP_SERVER}"
      recipients:
        - "platform@islasolve.com"
        - "security@islasolve.com"
    
    github:
      create_issue: true
      assign_to: ["platform-lead"]
      labels: ["auto-fix", "governance", "priority-high"]
  
  events:
    - trigger: fix_applied
      message: "自動修復已套用: ${FIX_SUMMARY}"
      severity: info
    
    - trigger: fix_failed
      message: "自動修復失敗: ${ERROR_MESSAGE}"
      severity: error
      escalate: true
    
    - trigger: policy_violation
      message: "Policy Gate違規: ${POLICY_NAME}"
      severity: critical
      escalate: true
      require_manual_review: true

# ==================== Audit Trail ====================
audit:
  enabled: true
  immutable_storage: true
  storage_path: "root-evidence/audit/auto-fix/"
  retention_days: 365
  
  tracked_events:
    - fix_triggered
    - fix_applied
    - fix_failed
    - policy_gate_checked
    - evidence_generated
    - notification_sent
  
  audit_format:
    timestamp: "RFC3339"
    actor: "auto-fix-bot"
    event_type: string
    target_files: array
    evidence_hash: "sha256"
    signature: "cosign"

# ==================== Rollback Configuration ====================
rollback:
  enabled: true
  automatic_rollback: false
  require_approval: true
  
  conditions:
    - name: test_failure_after_fix
      enabled: true
      rollback_action: revert_commits
    
    - name: policy_gate_failure
      enabled: true
      rollback_action: create_issue_and_block
    
    - name: evidence_corruption
      enabled: true
      rollback_action: emergency_stop
  
  rollback_steps:
    - name: backup_current_state
      command: "git stash push -m 'pre-rollback-backup-${TIMESTAMP}'"
    
    - name: revert_changes
      command: "git reset --hard ${BACKUP_COMMIT}"
    
    - name: verify_rollback
      command: |
        python scripts/verify_rollback.py \
          --target-state ${BACKUP_COMMIT} \
          --evidence root-evidence/rollback/

# ==================== Integration Commands ====================
integration:
  # GitHub Actions 整合
  github_actions:
    workflow_file: ".github/workflows/auto-fix-validation.yml"
    trigger_on: [push, pull_request]
    environment_vars:
      - COSIGN_PRIVATE_KEY
      - SLACK_WEBHOOK_URL
      - SMTP_SERVER
    
    steps:
      - name: Setup Environment
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install cosign syft jsonschema pyyaml
      
      - name: Run Auto-Fix Bot
        run: python scripts/auto_fix_bot.py --config auto-fix-bot.yml
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  
  # DevContainer 整合
  devcontainer:
    dockerfile: ".devcontainer/Dockerfile"
    extensions:
      - ms-python.python
      - ms-vscode.vscode-yaml
      - redhat.vscode-yaml
    
    post_create_commands:
      - "pip install -r requirements.txt"
      - "pre-commit install"
      - "python scripts/setup_auto_fix.py"

# ==================== MCP Servers 特定配置 ====================
mcp_servers_config:
  validation_rules:
    - name: import_restrictions
      description: "限制MCP servers的導入模組"
      allowed_imports:
        - json
        - asyncio
        - logging
        - pathlib
        - typing
        - dataclasses
        - enum
        - abc
        - contextlib
        - mcp.server
        - mcp.types
      forbidden_imports:
        - os.system
        - subprocess
        - eval
        - exec
        - __import__
    
    - name: security_checks
      description: "MCP servers安全性檢查"
      checks:
        - no_shell_execution
        - no_file_system_write_outside_sandbox
        - no_network_calls_without_approval
        - input_validation_required
    
    - name: type_annotation_requirements
      description: "強制型別標註要求"
      requirements:
        - all_functions_typed
        - all_class_methods_typed
        - return_types_specified
        - parameter_types_specified

# ==================== Advanced Architecture 整合 ====================
advanced_architecture_sync:
  source_patterns:
    - pattern: "advanced-system-src/**/*.py"
      destination: "advanced-system-dist/"
      transformation: "compile_and_optimize"
      validation: "run_unit_tests"
    
    - pattern: "advanced-system-src/**/*.yaml"
      destination: "advanced-system-dist/"
      transformation: "validate_and_minify"
      validation: "schema_check"
    
    - pattern: "advanced-system-src/**/*.json"
      destination: "advanced-system-dist/"
      transformation: "validate_and_compress"
      validation: "json_schema_validate"
  
  sync_commands:
    - name: pre_sync_validation
      command: |
        python scripts/validate_architecture_integrity.py \
          --src advanced-system-src/ \
          --checks all \
          --output root-evidence/architecture/pre-sync-validation.json
    
    - name: sync_with_transformation
      command: |
        python scripts/build/sync_architecture.py \
          --src advanced-system-src/ \
          --dist advanced-system-dist/ \
          --apply-transformations \
          --verify-integrity \
          --evidence root-evidence/build-sync/
    
    - name: post_sync_verification
      command: |
        python scripts/verify_sync_completeness.py \
          --src advanced-system-src/ \
          --dist advanced-system-dist/ \
          --evidence root-evidence/architecture/post-sync-verification.json

# ==================== Cross-Layer Bridges 整合 ====================
cross_layer_bridges:
  evidence_to_trust:
    enabled: true
    attestation_format: "in-toto"
    signing_key_type: "cosign"
    trust_root: "root-evidence/trust-anchors/"
    
    generators:
      - name: build_attestation
        trigger: "build_complete"
        predicate_type: "https://slsa.dev/provenance/v1"
        command: |
          python cross-layer-bridges/evidence-to-trust/generate_attestation.py \
            --type build \
            --builder ${GITHUB_WORKFLOW} \
            --source ${GITHUB_REPOSITORY} \
            --commit ${GITHUB_SHA} \
            --output root-evidence/attestation/build-attestation.json
      
      - name: deployment_attestation
        trigger: "deployment_complete"  
        predicate_type: "https://islasolve.com/deployment/v1"
        command: |
          python cross-layer-bridges/evidence-to-trust/generate_attestation.py \
            --type deployment \
            --environment ${DEPLOY_ENVIRONMENT} \
            --artifacts ${DEPLOYED_ARTIFACTS} \
            --output root-evidence/attestation/deployment-attestation.json

# ==================== Deep Validation Schema ====================
deep_validation_schema:
  yaml_structure_requirements:
    mandatory_sections:
      - metadata
      - version
      - owner
      - audit
    
    metadata_requirements:
      required_fields:
        - created_at
        - updated_at
        - labels
        - compliance_tags
      timestamp_format: "RFC3339"
      labels_min_count: 2
      compliance_tags_allowed:
        - slsa-l3
        - in-toto
        - audit-trail
        - axiom-free
        - deep-validation
    
    versioning_requirements:
      format: "semantic"
      pattern: "^\\d+\\.\\d+\\.\\d+$"
      changelog_required: true
    
    owner_requirements:
      required_fields:
        - team
        - contacts
      contact_format: "email"
      team_allowed_values:
        - platform-governance
        - security-team
        - development-team

# ==================== Evidence Chain Validation ====================
evidence_chain_validation:
  signature_requirements:
    algorithm: "ES256"
    key_type: "ECDSA P-256"
    certificate_chain: true
    timestamp_required: true
  
  attestation_requirements:
    format: "in-toto"
    statement_type: "https://in-toto.io/Statement/v0.1"
    predicate_required: true
    subject_digest: "sha256"
  
  provenance_requirements:
    format: "SLSA v1.0"
    builder_id_required: true
    build_type_required: true
    invocation_required: true
    materials_complete: true
  
  validation_chain:
    - step: verify_signatures
      command: |
        find root-evidence/ -name "*.json" -exec \
          cosign verify-blob --signature {}.sig \
          --certificate-identity-regexp ".*@islasolve\.com" {} \;
    
    - step: validate_attestations
      command: |
        python scripts/validate_attestations.py \
          --evidence-dir root-evidence/ \
          --schema schemas/attestation-schema.json \
          --output root-evidence/validation/attestation-validation.json
    
    - step: verify_provenance_chain
      command: |
        python scripts/verify_provenance_chain.py \
          --provenance-dir root-evidence/provenance/ \
          --trust-root root-evidence/trust-anchors/ \
          --output root-evidence/validation/provenance-validation.json

# ==================== Error Recovery Procedures ====================
error_recovery:
  procedures:
    - name: schema_validation_failure
      description: "Schema驗證失敗時的復原程序"
      steps:
        - backup_current_file
        - restore_from_template
        - merge_existing_data
        - re_validate
        - notify_team
      
    - name: evidence_corruption_detected
      description: "證據完整性受損時的應急程序"
      steps:
        - isolate_corrupted_evidence
        - restore_from_backup
        - re_generate_signatures
        - audit_corruption_cause
        - escalate_to_security_team
      
    - name: policy_gate_permanent_failure
      description: "Policy Gate持續失敗的處理程序"
      steps:
        - create_emergency_issue
        - disable_auto_merge
        - require_manual_review
        - escalate_to_governance_team
        - document_exception_request

# ==================== Monitoring & Observability ====================
monitoring:
  metrics:
    - name: fix_success_rate
      type: percentage
      query: "successful_fixes / total_fix_attempts * 100"
      threshold: 95
      alert_on_below: true
    
    - name: average_fix_time
      type: duration
      query: "avg(fix_completion_time - fix_start_time)"
      threshold: "5m"
      alert_on_above: true
    
    - name: policy_gate_failure_rate
      type: percentage
      query: "failed_policy_checks / total_policy_checks * 100"
      threshold: 5
      alert_on_above: true
  
  dashboards:
    - name: auto_fix_overview
      panels:
        - fix_attempts_over_time
        - success_rate_by_rule_type
        - average_resolution_time
        - policy_gate_status
        - evidence_generation_status
    
    - name: security_compliance
      panels:
        - signature_verification_status
        - attestation_coverage
        - audit_trail_completeness
        - vulnerability_detection_rate

# ============================================================================
# 監控與告警 (Monitoring & Alerting)
# ============================================================================
monitoring:
  enabled: true
  
  # 指標收集
  metrics:
    prometheus:
      enabled: true
      port: 9090
      scrape_interval: 15s
      retention: "15d"
    
    custom_metrics:
      - issues_detected_total
      - issues_fixed_total
      - analysis_duration_seconds
      - repair_success_rate
  
  # 日誌收集
  logging:
    loki:
      enabled: true
      url: "http://loki:3100"
      retention: "30d"
    
    format: "json"
    level: "INFO"
    rotation:
      max_size: "100MB"
      max_age: "7d"
  
  # 分布式追蹤
  tracing:
    jaeger:
      enabled: true
      endpoint: "http://jaeger:6831"
      sampling_rate: 0.1
  
  # 告警規則
  alerts:
    - name: high_vulnerability_detected
      enabled: true
      severity: "CRITICAL"
      condition: "vulnerability.severity == CRITICAL"
      channels: ["email", "slack", "pagerduty"]
    
    - name: repair_failure_rate
      enabled: true
      threshold: 0.1
      condition: "repair_failures / total_repairs > 0.1"
      channels: ["email", "slack"]
    
    - name: analysis_timeout
      enabled: true
      threshold: 300
      condition: "analysis_duration > 300"
      channels: ["slack"]

# ============================================================================
# 安全配置 (Security Configuration)
# ============================================================================
security:
  # 認證
  authentication:
    enabled: true
    method: "oauth2"
    provider: "github"
    scopes: ["repo", "read:org"]
  
  # 授權
  authorization:
    enabled: true
    rbac: true
    roles:
      - name: admin
        permissions: ["read", "write", "delete", "approve"]
      - name: reviewer
        permissions: ["read", "write", "approve"]
      - name: developer
        permissions: ["read", "write"]
      - name: viewer
        permissions: ["read"]
  
  # 加密
  encryption:
    enabled: true
    algorithm: "AES-256-GCM"
    key_rotation: 86400  # 24 小時
    at_rest: true
    in_transit: true
  
  # 審計
  audit:
    enabled: true
    log_all_actions: true
    retention_days: 90
    immutable: true
    blockchain_backed: true  # 企業級 SLSA Level 3 合規要求
    blockchain_provider: "hyperledger"  # 可選: hyperledger, ethereum, custom

# ============================================================================
# 通知配置 (Notifications)
# ============================================================================
notifications:
  enabled: true
  
  channels:
    - name: email
      enabled: true
      smtp_server: "${SMTP_SERVER}"
      from: "autofix@slasolve.com"
      to: ["platform@slasolve.com"]
    
    - name: slack
      enabled: true
      webhook_url: "${SLACK_WEBHOOK}"
      channel: "#auto-fix-alerts"
    
    - name: github
      enabled: true
      token: "${GITHUB_TOKEN}"
      create_issues: true
      create_pr_comments: true
    
    - name: webhook
      enabled: true
      url: "${WEBHOOK_URL}"
      method: "POST"
      headers:
        Content-Type: "application/json"
  
  # 通知規則
  rules:
    - name: vulnerability_found
      channels: ["email", "slack", "github"]
      severity: ["HIGH", "CRITICAL"]
      template: "vulnerability_alert"
    
    - name: repair_completed
      channels: ["github"]
      create_pr: true
      template: "repair_summary"
    
    - name: analysis_failed
      channels: ["email", "slack"]
      template: "analysis_error"

# ============================================================================
# 數據存儲 (Storage)
# ============================================================================
storage:
  # 結果存儲
  results:
    backend: "postgresql"
    connection: "${DATABASE_URL}"
    retention_days: 365
    encryption: true
  
  # 緩存
  cache:
    backend: "redis"
    connection: "${REDIS_URL}"
    ttl: 3600
    max_memory: "2GB"
  
  # 文件存儲
  files:
    backend: "s3"
    bucket: "${S3_BUCKET}"
    region: "${AWS_REGION}"
    versioning: true

# ============================================================================
# 語言支持 (Language Support)
# ============================================================================
languages:
  python:
    enabled: true
    version: "3.9+"
    tools: ["pylint", "black", "mypy", "bandit"]
    test_framework: "pytest"
  
  javascript:
    enabled: true
    version: "14+"
    tools: ["eslint", "prettier", "typescript"]
    test_framework: "jest"
  
  typescript:
    enabled: true
    version: "5.0+"
    tools: ["tslint", "prettier"]
    test_framework: "jest"
  
  go:
    enabled: true
    version: "1.18+"
    tools: ["golangci-lint", "gofmt", "go vet"]
    test_framework: "go test"
  
  rust:
    enabled: true
    version: "1.60+"
    tools: ["clippy", "rustfmt"]
    test_framework: "cargo test"
  
  java:
    enabled: true
    version: "11+"
    tools: ["checkstyle", "spotbugs", "pmd"]
    test_framework: "junit"

# ============================================================================
# 報告配置 (Reporting)
# ============================================================================
reporting:
  enabled: true
  
  # 報告格式
  formats:
    - name: json
      enabled: true
      schema_version: "1.0"
    - name: html
      enabled: true
      template: "default"
    - name: pdf
      enabled: true
      include_charts: true
    - name: markdown
      enabled: true
      include_toc: true
  
  # 報告內容
  content:
    - summary: true
    - vulnerabilities: true
    - performance_issues: true
    - code_quality: true
    - recommendations: true
    - metrics: true
    - trend_analysis: true
  
  # 報告分發
  distribution:
    - email: true
    - slack: true
    - github: true
    - dashboard: true
    - s3: true

# ============================================================================
# 六大骨架 × 多語言治理架構
# ============================================================================
multi_language_governance:
  
  framework_1_popular_languages:
    name: "流行語言 (Popular Languages)"
    languages: [Python, JavaScript, TypeScript, Go, Rust]
    use_cases:
      - 快速原型開發
      - 治理模組自動化
      - 跨平台工具鏈
  
  framework_2_server_side_languages:
    name: "服務器端語言 (Server-side Languages)"
    languages: [Java, "C#", Node.js, Kotlin, Scala]
    use_cases:
      - 後端 API 開發
      - 微服務治理
      - 企業級系統
  
  framework_3_web_languages:
    name: "Web語言 (Web Languages)"
    languages: [JavaScript, TypeScript, HTML, CSS]
    use_cases:
      - UI 治理觀測
      - 前端 SDK 封裝
      - 治理可視化
  
  framework_4_mobile_languages:
    name: "移動語言 (Mobile Languages)"
    languages: [Swift, Kotlin, Dart, "React Native"]
    use_cases:
      - 移動端治理 SDK
      - 觀測模組
      - 跨平台治理工具
  
  framework_5_data_representation_languages:
    name: "數據表示語言 (Data Representation Languages)"
    languages: [JSON, YAML, XML, "Protocol Buffers"]
    use_cases:
      - 治理邊界文件
      - 責任矩陣定義
      - 事件日誌記錄
      - 配置管理
  
  framework_6_other_languages:
    name: "其它語言 (Other Languages)"
    languages: ["C++", Haskell, Elixir, Zig]
    use_cases:
      - 高性能治理模組
      - 安全性強化
      - 函數式治理邏輯

# ==================== Changelog ====================
changelog:
  - ts: "2025-01-17T12:00:00Z"
    by: "platform-governance"
    version: "1.0.0"
    change: "初始Auto-Fix Bot配置，支援基本YAML驗證與修復"
  - ts: "2025-01-17T12:15:00Z"
    by: "security-team"
    version: "1.5.0"
    change: "新增Policy Gate整合與證據鏈生成"
  - ts: "2025-01-17T12:30:00Z"
    by: "platform-governance"
    version: "2.0.0"
    change: "完整整合深度可驗證模組、去標籤化架構策略與Islasolve專案架構適配"
  - ts: "2025-11-25T14:39:00Z"
    by: "automation-architect"
    version: "3.0.0"
    change: "Phase 1 生產就緒配置：企業級代碼分析、自動修復、監控告警、多語言治理架構"
