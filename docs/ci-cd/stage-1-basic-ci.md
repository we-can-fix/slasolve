# Stage 1 - 基礎 CI 自動評論機制

## 📋 概述

Stage 1 是漸進式部署策略的第一階段，提供基礎的持續整合（CI）自動評論功能。這個階段專注於建立基礎的自動化檢查和 PR 評論機制，為後續的 Stage 2 和 Stage 3 奠定基礎。

## 🎯 目標

1. **PR 自動評論**：在 Pull Request 中自動發布測試結果和檢查狀態
2. **基礎環境檢查**：驗證執行環境的健康狀態
3. **測試執行**：自動運行專案的基礎測試套件
4. **測試覆蓋率**：收集並報告測試覆蓋率資訊

## 🚀 功能特性

### 自動化檢查項目

- ✅ **環境健康檢查**：驗證 Node.js、NPM 版本和作業系統資訊
- ✅ **基礎測試執行**：運行 Contracts L1 服務的測試套件
- ✅ **測試覆蓋率分析**：收集並評估測試覆蓋率（目標：≥80%）
- ✅ **PR 自動評論**：在 PR 中發布詳細的檢查結果

### 評論內容

工作流程會在 PR 中自動發布包含以下內容的評論：

1. **測試結果**：顯示測試是否通過
2. **環境健康狀態**：報告環境配置情況
3. **測試覆蓋率**：顯示當前覆蓋率並提供建議
4. **檢查詳情表格**：以表格形式總結所有檢查項目
5. **建議與後續步驟**：根據檢查結果提供可行的建議

## 📁 檔案位置

- **工作流程檔案**：`.github/workflows/stage-1-basic-ci.yml`
- **文檔位置**：`docs/ci-cd/stage-1-basic-ci.md`

## 🔄 觸發條件

工作流程在以下情況下自動觸發：

```yaml
on:
  pull_request:
    branches: [main, develop]
```

- 當 PR 針對 `main` 或 `develop` 分支時
- PR 建立、更新或同步時

## 📊 工作流程步驟

1. **檢出代碼**：從 GitHub 取得最新代碼
2. **設定 Node.js**：配置 Node.js 18 環境
3. **安裝依賴**：安裝專案依賴
4. **環境健康檢查**：驗證執行環境
5. **運行測試**：執行 Contracts L1 服務測試
6. **測試覆蓋率檢查**：分析測試覆蓋率
7. **自動評論**：在 PR 中發布檢查結果
8. **CI 摘要**：生成 GitHub Actions 摘要

## 📈 覆蓋率標準

| 覆蓋率 | 狀態 | 建議 |
|--------|------|------|
| ≥80% | ✅ 通過 | 符合要求 |
| 60-79% | ⚠️ 警告 | 建議提升至 80% 以上 |
| <60% | ❌ 未達標 | 需要增加測試 |

## 🛠️ 使用方式

### 自動觸發

當您建立或更新針對 `main` 或 `develop` 分支的 PR 時，工作流程會自動執行。

### 檢查結果

1. 在 PR 頁面的 **Checks** 標籤查看詳細執行日誌
2. 在 PR 評論區查看自動發布的檢查結果摘要
3. 在 GitHub Actions 頁面查看完整的執行歷史

## 🔍 故障排除

### 測試失敗

如果測試失敗：

1. 查看 PR 評論中的失敗訊息
2. 點擊「查看完整 CI 日誌」連結查看詳細錯誤
3. 在本地執行 `npm test` 重現問題
4. 修復測試後推送更新，工作流程會自動重新執行

### 環境問題

如果環境檢查失敗：

1. 確認本地環境符合要求（Node.js ≥18.0.0）
2. 檢查 `package.json` 中的依賴是否正確
3. 確保 `package-lock.json` 已提交

## 📚 相關文檔

- [漸進部署指南](../../README.md) - 完整的漸進部署策略
- [Stage 2 - 增強 CI](./stage-2-enhanced-ci.md) - 下一階段（待實作）
- [Stage 3 - 生產 CD](./stage-3-production-cd.md) - 最終階段（待實作）

## 🎓 團隊培訓

### 第 1 週：理解基礎概念

- 閱讀本文檔
- 觀察工作流程執行
- 理解 PR 評論內容

### 第 2 週：實踐與優化

- 建立測試 PR
- 根據評論反饋修復問題
- 熟悉 CI 工作流程

## ⏱️ 時間表

- **Week 1-2**：實現基礎 CI 評論機制 ✅
- **Week 3-4**：團隊培訓 + 優化工作流程

## 📊 成功指標

- ✅ PR 自動評論功能正常運作
- ✅ 測試執行成功率 ≥95%
- ✅ 團隊成員熟悉工作流程
- ✅ 測試覆蓋率保持 ≥80%

## 🔜 下一步

完成 Stage 1 後，將進入 Stage 2：

- 實現風險評估功能
- 自動部署到 Staging 環境
- 集成測試驗證
- 自動驗證部署結果

---

**版本**：1.0.0  
**最後更新**：2025-11-26  
**維護者**：SLASolve Team
