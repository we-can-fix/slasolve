# éƒ¨ç½² CI å‡ç´šè¨ˆåŠƒ - é«˜éšè¦åŠƒæ–‡æª”

## ğŸ“‹ æ¦‚è¦½

æœ¬æ–‡æª”è¦åŠƒå‰©é¤˜ **3 å€‹éƒ¨ç½²ç›¸é—œ CI workflows** çš„å‡ç´šç­–ç•¥ï¼Œå°‡å®ƒå€‘æ•´åˆåˆ°äº’å‹•å¼ CI æœå‹™ç³»çµ±ä¸­ã€‚

### å‡ç´šç›®æ¨™

| # | CI Workflow | é¡å‹ | è¤‡é›œåº¦ | å„ªå…ˆç´š | é è¨ˆæ™‚é–“ |
|---|-------------|------|--------|--------|---------|
| 1 | Deploy Contracts L1 | éƒ¨ç½² | â­â­â­â­ | é«˜ | 2-3 å°æ™‚ |
| 2 | Auto-Fix Bot | åˆ†æå·¥å…· | â­â­â­ | ä¸­ | 1-2 å°æ™‚ |
| 3 | MCP Servers CD | å®¹å™¨éƒ¨ç½² | â­â­ | ä¸­ | 1 å°æ™‚ |

**ç¸½é è¨ˆæ™‚é–“**: 4-6 å°æ™‚

---

## ğŸ¯ å‡ç´šç­–ç•¥

### æ ¸å¿ƒåŸå‰‡

1. **æ¼¸é€²å¼æ•´åˆ** - é€å€‹ workflow å‡ç´šï¼Œé¿å…ä¸€æ¬¡æ€§å¤§è¦æ¨¡è®Šæ›´
2. **ä¿æŒåŠŸèƒ½å®Œæ•´** - æ‰€æœ‰åŸæœ‰éƒ¨ç½²åŠŸèƒ½å¿…é ˆå®Œæ•´ä¿ç•™
3. **å°ˆæ³¨å¤±æ•—è¨ºæ–·** - åƒ…åœ¨å¤±æ•—æ™‚æä¾›æ™ºèƒ½è¨ºæ–·ï¼ŒæˆåŠŸæ™‚éœé»˜è™•ç†
4. **æœ€å°æ¬Šé™åŸå‰‡** - åƒ…æ·»åŠ å¿…è¦çš„ `pull-requests: write` å’Œ `issues: write` æ¬Šé™

### æ¢ä»¶åŸ·è¡Œç­–ç•¥

| Workflow | äº’å‹•å¼åé¥‹è§¸ç™¼æ¢ä»¶ | åŸå›  |
|----------|------------------|------|
| Deploy Contracts L1 | PR only | é¿å… push/éƒ¨ç½²æ™‚éå¤šè©•è«– |
| Auto-Fix Bot | PR only | åˆ†æå·¥å…·åƒ…åœ¨ PR æ™‚éœ€è¦åé¥‹ |
| MCP Servers CD | PR only | éƒ¨ç½²æµç¨‹åœ¨ push æ™‚é€šéæ—¥èªŒæŸ¥çœ‹ |

---

## 1ï¸âƒ£ Deploy Contracts L1 å‡ç´šè¨ˆåŠƒ

### ç•¶å‰ç‹€æ…‹åˆ†æ

**workflow ä½ç½®**: `.github/workflows/deploy-contracts-l1.yml`

**ç‰¹é»**:
- ğŸ”¨ è¤‡é›œçš„å¤šéšæ®µæµç¨‹ï¼ˆå»ºç½®ã€æ¸¬è©¦ã€SBOMã€Dockerã€å®‰å…¨æƒæã€éƒ¨ç½²ï¼‰
- ğŸ³ Docker é¡åƒå»ºç½®å’Œæ¨é€
- ğŸ”’ å®‰å…¨æƒæï¼ˆTrivyï¼‰
- ğŸš€ å¤šç’°å¢ƒéƒ¨ç½²ï¼ˆStagingã€Productionï¼‰
- ğŸ“‹ SBOM ç”Ÿæˆ

**Jobs çµæ§‹**:
```
build-and-test (åŸºç¤)
â”œâ”€ generate-sbom (SBOM ç”Ÿæˆ)
â”œâ”€ build-docker (Docker å»ºç½®)
â”‚  â””â”€ security-scan (å®‰å…¨æƒæ)
â”‚     â”œâ”€ deploy-staging (Staging éƒ¨ç½²)
â”‚     â””â”€ deploy-production (Production éƒ¨ç½²)
```

**è§¸ç™¼æ¢ä»¶**:
- `push` to main (é‡å° contracts è·¯å¾‘)
- `pull_request` (é‡å° contracts è·¯å¾‘)
- `workflow_dispatch` (æ‰‹å‹•è§¸ç™¼)

### å‡ç´šå¯¦æ–½æ–¹æ¡ˆ

#### éšæ®µ 1ï¼šæ·»åŠ æ¬Šé™

```yaml
permissions:
  contents: read
  packages: write
  id-token: write
  pull-requests: write  # æ–°å¢ï¼šç™¼å¸ƒäº’å‹•å¼è©•è«–
  issues: write         # æ–°å¢ï¼šæ¨™ç±¤ç®¡ç†
```

#### éšæ®µ 2ï¼šè¨­è¨ˆç‹€æ…‹è¨ˆç®—é‚è¼¯

**é—œéµè€ƒæ…®**ï¼š
- éƒ¨ç½² jobs (`deploy-staging`, `deploy-production`) åƒ…åœ¨ç‰¹å®šæ¢ä»¶ä¸‹åŸ·è¡Œ
- éœ€è¦æª¢æŸ¥æ‰€æœ‰ã€Œå¿…é ˆåŸ·è¡Œã€çš„ jobsï¼š`build-and-test`, `generate-sbom`, `build-docker`, `security-scan`
- éƒ¨ç½² jobs å¯èƒ½è¢«è·³éï¼ˆä¸å½±éŸ¿æ•´é«”ç‹€æ…‹ï¼‰

**ç‹€æ…‹è¨ˆç®—**ï¼š
```yaml
ci-status: ${{ 
  (needs.build-and-test.result == 'success' && 
   needs.generate-sbom.result == 'success' && 
   needs.build-docker.result == 'success' && 
   needs.security-scan.result == 'success') 
  && 'success' || 'failure' 
}}
```

#### éšæ®µ 3ï¼šæ·»åŠ äº’å‹•å¼æœå‹™ Job

```yaml
# ==================== äº’å‹•å¼å®¢æœæ•´åˆ ====================
# Note: åƒ…åœ¨ PR æ™‚æä¾›äº’å‹•å¼åé¥‹ï¼Œé¿å…éƒ¨ç½²æµç¨‹ç”¢ç”Ÿéå¤šè©•è«–
interactive-service:
  name: ğŸ¤– Contracts L1 Deployment äº’å‹•å¼å®¢æœ
  needs: [build-and-test, generate-sbom, build-docker, security-scan]
  if: always() && github.event_name == 'pull_request'
  uses: ./.github/workflows/interactive-ci-service.yml
  with:
    ci-name: "Deploy Contracts L1"
    ci-status: ${{ 
      (needs.build-and-test.result == 'success' && 
       needs.generate-sbom.result == 'success' && 
       needs.build-docker.result == 'success' && 
       needs.security-scan.result == 'success') 
      && 'success' || 'failure' 
    }}
    ci-context: |
      {
        "build_result": "${{ needs.build-and-test.result }}",
        "sbom_result": "${{ needs.generate-sbom.result }}",
        "docker_result": "${{ needs.build-docker.result }}",
        "security_result": "${{ needs.security-scan.result }}",
        "event_type": "${{ github.event_name }}"
      }
    error-logs: ${{ 
      (needs.build-and-test.result == 'failure' || 
       needs.generate-sbom.result == 'failure' || 
       needs.build-docker.result == 'failure' || 
       needs.security-scan.result == 'failure') 
      && 'Contracts L1 éƒ¨ç½²æµç¨‹å¤±æ•—ï¼Œè«‹æŸ¥çœ‹å„éšæ®µè©³ç´°æ—¥èªŒ' || '' 
    }}
  permissions:
    contents: read
    pull-requests: write
    issues: write
```

#### éšæ®µ 4ï¼šéŒ¯èª¤è¨ºæ–·å¢å¼·

**é‡å°æ€§è¨ºæ–·**ï¼š
- **Build å¤±æ•—** â†’ TypeScript ç·¨è­¯éŒ¯èª¤ã€ä¾è³´å•é¡Œ
- **Docker å¤±æ•—** â†’ Dockerfile èªæ³•ã€åŸºç¤é¡åƒå•é¡Œ
- **Security å¤±æ•—** â†’ æ¼æ´æª¢æ¸¬ã€åš´é‡ç¨‹åº¦éé«˜
- **SBOM å¤±æ•—** â†’ ä¾è³´æƒæå•é¡Œ

### æ¸¬è©¦è¨ˆåŠƒ

1. **PR æ¸¬è©¦** - å»ºç«‹æ¸¬è©¦ PRï¼Œè§¸ç™¼æ‰€æœ‰ jobs
2. **å¤±æ•—å ´æ™¯æ¸¬è©¦** - æ•…æ„å¼•å…¥éŒ¯èª¤ï¼Œé©—è­‰è¨ºæ–·èƒ½åŠ›
3. **Push æ¸¬è©¦** - é©—è­‰ push äº‹ä»¶ä¸ç”¢ç”Ÿè©•è«–
4. **éƒ¨ç½²æ¸¬è©¦** - é©—è­‰éƒ¨ç½² jobs ä¸å½±éŸ¿äº’å‹•å¼æœå‹™

### é¢¨éšªè©•ä¼°

| é¢¨éšª | ç­‰ç´š | ç·©è§£æªæ–½ |
|------|------|---------|
| éƒ¨ç½²æµç¨‹ä¸­æ–· | ä½ | äº’å‹•å¼æœå‹™åœ¨æœ€å¾ŒåŸ·è¡Œï¼Œä¸é˜»å¡éƒ¨ç½² |
| æ¬Šé™éåº¦ | ä½ | åƒ…æ·»åŠ å¿…è¦çš„ PR å’Œ Issues æ¬Šé™ |
| è©•è«–éå¤š | ä½ | åƒ…åœ¨ PR äº‹ä»¶è§¸ç™¼ |

---

## 2ï¸âƒ£ Auto-Fix Bot å‡ç´šè¨ˆåŠƒ

### ç•¶å‰ç‹€æ…‹åˆ†æ

**workflow ä½ç½®**: `.github/workflows/autofix-bot.yml`

**ç‰¹é»**:
- ğŸ¤– ä»£ç¢¼åˆ†æèˆ‡è‡ªå‹•ä¿®å¾©æ¼”ç¤º
- â˜ï¸ é›²ç«¯ä»£ç†ç¨‹å¼å§”æ´¾
- ğŸ“Š æ•ˆç‡çµ±è¨ˆå ±å‘Š
- ğŸ¨ è±å¯Œçš„è¦–è¦ºè¼¸å‡º

**Jobs çµæ§‹**:
```
analyze-and-fix (åˆ†æèˆ‡ä¿®å¾©)
â””â”€ cloud-delegation (é›²ç«¯å§”æ´¾)
   â””â”€ efficiency-report (æ•ˆç‡å ±å‘Š)
```

**è§¸ç™¼æ¢ä»¶**:
- `pull_request` (opened, synchronize, reopened)
- `push` to main/develop
- `workflow_dispatch`

### å‡ç´šå¯¦æ–½æ–¹æ¡ˆ

#### éšæ®µ 1ï¼šæ·»åŠ æ¬Šé™

```yaml
permissions:
  contents: read
  pull-requests: write  # ç¾æœ‰ + äº’å‹•å¼è©•è«–
  issues: write         # æ–°å¢ï¼šæ¨™ç±¤ç®¡ç†
```

#### éšæ®µ 2ï¼šè¨­è¨ˆç‹€æ…‹è¨ˆç®—é‚è¼¯

**ç°¡å–®é‚è¼¯** - æ‰€æœ‰ 3 å€‹ jobs éƒ½å¿…é ˆæˆåŠŸï¼š

```yaml
ci-status: ${{ 
  (needs.analyze-and-fix.result == 'success' && 
   needs.cloud-delegation.result == 'success' && 
   needs.efficiency-report.result == 'success') 
  && 'success' || 'failure' 
}}
```

#### éšæ®µ 3ï¼šæ·»åŠ äº’å‹•å¼æœå‹™ Job

```yaml
# ==================== äº’å‹•å¼å®¢æœæ•´åˆ ====================
# Note: åƒ…åœ¨ PR æ™‚æä¾›äº’å‹•å¼åé¥‹ï¼Œpush äº‹ä»¶é€šéæ—¥èªŒæŸ¥çœ‹
interactive-service:
  name: ğŸ¤– Auto-Fix Bot äº’å‹•å¼å®¢æœ
  needs: [analyze-and-fix, cloud-delegation, efficiency-report]
  if: always() && github.event_name == 'pull_request'
  uses: ./.github/workflows/interactive-ci-service.yml
  with:
    ci-name: "Auto-Fix Bot"
    ci-status: ${{ 
      (needs.analyze-and-fix.result == 'success' && 
       needs.cloud-delegation.result == 'success' && 
       needs.efficiency-report.result == 'success') 
      && 'success' || 'failure' 
    }}
    ci-context: |
      {
        "analysis_result": "${{ needs.analyze-and-fix.result }}",
        "delegation_result": "${{ needs.cloud-delegation.result }}",
        "report_result": "${{ needs.efficiency-report.result }}"
      }
    error-logs: ${{ 
      (needs.analyze-and-fix.result == 'failure' || 
       needs.cloud-delegation.result == 'failure' || 
       needs.efficiency-report.result == 'failure') 
      && 'Auto-Fix Bot åŸ·è¡Œå¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°æ—¥èªŒ' || '' 
    }}
  permissions:
    contents: read
    pull-requests: write
    issues: write
```

#### éšæ®µ 4ï¼šéŒ¯èª¤è¨ºæ–·å¢å¼·

**é‡å°æ€§è¨ºæ–·**ï¼š
- **åˆ†æå¤±æ•—** â†’ ä»£ç¢¼æƒæå•é¡Œã€ä¾è³´ç¼ºå¤±
- **å§”æ´¾å¤±æ•—** â†’ é›²ç«¯ä»£ç†ç¨‹å¼é€£æ¥å•é¡Œ
- **å ±å‘Šå¤±æ•—** â†’ æ•¸æ“šæ”¶é›†æˆ–æ ¼å¼åŒ–å•é¡Œ

### æ¸¬è©¦è¨ˆåŠƒ

1. **PR æ¸¬è©¦** - é©—è­‰æ‰€æœ‰åˆ†ææµç¨‹
2. **å¤±æ•—å ´æ™¯æ¸¬è©¦** - å„éšæ®µå¤±æ•—æ¸¬è©¦
3. **Push æ¸¬è©¦** - ç¢ºèªä¸ç”¢ç”Ÿè©•è«–

### é¢¨éšªè©•ä¼°

| é¢¨éšª | ç­‰ç´š | ç·©è§£æªæ–½ |
|------|------|---------|
| åˆ†æä¸­æ–· | ä½ | äº’å‹•å¼æœå‹™åœ¨æœ€å¾ŒåŸ·è¡Œ |
| æ¼”ç¤ºè¼¸å‡ºæ··äº‚ | ä½ | æ¸…æ™°çš„ job åˆ†é›¢ |

---

## 3ï¸âƒ£ MCP Servers CD å‡ç´šè¨ˆåŠƒ

### ç•¶å‰ç‹€æ…‹åˆ†æ

**workflow ä½ç½®**: `.github/workflows/mcp-servers-cd.yml`

**ç‰¹é»**:
- ğŸ”„ ä½¿ç”¨å¯é‡ç”¨ workflow (`project-cd.yml`)
- ğŸ³ å®¹å™¨å»ºç½®å’Œéƒ¨ç½²
- ğŸ” Cosign ç°½å
- ğŸ“‹ SBOM ç”Ÿæˆ
- ğŸ›¡ï¸ Policy æª¢æŸ¥

**Jobs çµæ§‹**:
```
cd (èª¿ç”¨ project-cd.yml)
  â””â”€ [project-cd.yml çš„æ‰€æœ‰ jobs]
```

**è§¸ç™¼æ¢ä»¶**:
- `push` to main/develop (é‡å° mcp-servers è·¯å¾‘)
- `workflow_dispatch`

### å‡ç´šå¯¦æ–½æ–¹æ¡ˆ

#### æŒ‘æˆ°

âš ï¸ **ç‰¹æ®Šæƒ…æ³**ï¼šæ­¤ workflow ä½¿ç”¨å¯é‡ç”¨ workflow (`uses: ./.github/workflows/project-cd.yml`)

**å…©ç¨®å‡ç´šæ–¹æ¡ˆ**ï¼š

##### æ–¹æ¡ˆ Aï¼šåœ¨èª¿ç”¨å±¤æ·»åŠ äº’å‹•å¼æœå‹™ï¼ˆæ¨è–¦ï¼‰

**å„ªé»**ï¼š
- ä¸ä¿®æ”¹ `project-cd.yml`ï¼ˆä¿æŒå¯é‡ç”¨æ€§ï¼‰
- ç°¡å–®ç›´æ¥

**ç¼ºé»**ï¼š
- ç„¡æ³•ç²å– `project-cd.yml` å…§éƒ¨ jobs çš„è©³ç´°ç‹€æ…‹

**å¯¦æ–½**ï¼š
```yaml
jobs:
  cd:
    uses: ./.github/workflows/project-cd.yml
    with:
      # ... ç¾æœ‰åƒæ•¸ ...
    secrets:
      # ... ç¾æœ‰ secrets ...
  
  # ==================== äº’å‹•å¼å®¢æœæ•´åˆ ====================
  # Note: åƒ…åœ¨ PR æ™‚æä¾›äº’å‹•å¼åé¥‹
  interactive-service:
    name: ğŸ¤– MCP Servers CD äº’å‹•å¼å®¢æœ
    needs: [cd]
    if: always() && github.event_name == 'pull_request'
    uses: ./.github/workflows/interactive-ci-service.yml
    with:
      ci-name: "MCP Servers CD"
      ci-status: ${{ needs.cd.result }}
      ci-context: |
        {
          "cd_result": "${{ needs.cd.result }}",
          "environment": "${{ inputs.environment || 'dev' }}"
        }
      error-logs: ${{ needs.cd.result == 'failure' && 'MCP Servers CD å¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°æ—¥èªŒ' || '' }}
    permissions:
      contents: read
      pull-requests: write
      issues: write
```

##### æ–¹æ¡ˆ Bï¼šä¿®æ”¹ `project-cd.yml`ï¼ˆå®Œæ•´ä½†è¤‡é›œï¼‰

**å„ªé»**ï¼š
- å¯ä»¥ç²å–å…§éƒ¨ jobs çš„è©³ç´°ç‹€æ…‹
- å°æ‰€æœ‰ä½¿ç”¨ `project-cd.yml` çš„ workflows ç”Ÿæ•ˆ

**ç¼ºé»**ï¼š
- éœ€è¦ä¿®æ”¹å¯é‡ç”¨ workflow
- å½±éŸ¿ç¯„åœæ›´å¤§
- è¤‡é›œåº¦å¢åŠ 

**æ±ºç­–**ï¼š**æ¡ç”¨æ–¹æ¡ˆ A**ï¼ˆç°¡å–®ä¸”å®‰å…¨ï¼‰

#### éšæ®µ 1ï¼šæ·»åŠ äº’å‹•å¼æœå‹™ Jobï¼ˆä½¿ç”¨æ–¹æ¡ˆ Aï¼‰

**æ³¨æ„äº‹é …**ï¼š
- æ­¤ workflow ç•¶å‰æ²’æœ‰æ˜ç¢ºçš„ `permissions` å€å¡Š
- éœ€è¦åœ¨äº’å‹•å¼æœå‹™ job ä¸­æ˜ç¢ºæŒ‡å®šæ¬Šé™

#### éšæ®µ 2ï¼šè§¸ç™¼æ¢ä»¶

**ç•¶å‰è§¸ç™¼**ï¼š
- `push` to main/develop
- `workflow_dispatch`

**å•é¡Œ**ï¼šæ²’æœ‰ `pull_request` è§¸ç™¼ï¼

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. **é¸é … 1**ï¼šæ·»åŠ  `pull_request` è§¸ç™¼ï¼ˆæ¨è–¦ï¼‰
   ```yaml
   on:
     push:
       branches: [main, develop]
       paths: ['mcp-servers/**', ...]
     pull_request:  # æ–°å¢
       paths: ['mcp-servers/**', ...]
     workflow_dispatch:
       # ... ç¾æœ‰é…ç½® ...
   ```

2. **é¸é … 2**ï¼šåƒ…åœ¨ push æ™‚æä¾›è¨ºæ–·ï¼ˆä¸æ¨è–¦ï¼Œå› ç‚ºæœƒç”¢ç”Ÿéå¤šè©•è«–ï¼‰

**æ±ºç­–**ï¼š**æ¡ç”¨é¸é … 1**ï¼ˆæ·»åŠ  PR è§¸ç™¼ï¼‰

### æ¸¬è©¦è¨ˆåŠƒ

1. **PR æ¸¬è©¦** - æ·»åŠ  PR è§¸ç™¼å¾Œæ¸¬è©¦
2. **Push æ¸¬è©¦** - é©—è­‰ä¸ç”¢ç”Ÿè©•è«–
3. **å¯é‡ç”¨æ€§æ¸¬è©¦** - ç¢ºä¿ä¸å½±éŸ¿å…¶ä»–ä½¿ç”¨ `project-cd.yml` çš„ workflows

### é¢¨éšªè©•ä¼°

| é¢¨éšª | ç­‰ç´š | ç·©è§£æªæ–½ |
|------|------|---------|
| å½±éŸ¿å…¶ä»– workflows | ä½ | ä½¿ç”¨æ–¹æ¡ˆ Aï¼Œä¸ä¿®æ”¹ `project-cd.yml` |
| PR è§¸ç™¼æ–°å¢ | ä½ | æ¨™æº–æ“ä½œï¼Œé¢¨éšªå¯æ§ |
| ç‹€æ…‹ä¿¡æ¯æœ‰é™ | ä¸­ | æ¥å—é™åˆ¶ï¼Œä¿æŒç°¡å–®æ€§ |

---

## ğŸ¯ æ•´é«”å¯¦æ–½è¨ˆåŠƒ

### å¯¦æ–½é †åºï¼ˆæ¨è–¦ï¼‰

1. **ç¬¬ä¸€æ‰¹ï¼šAuto-Fix Bot**ï¼ˆ1-2 å°æ™‚ï¼‰
   - ç†ç”±ï¼šæœ€ç°¡å–®ï¼Œ3 å€‹ç¨ç«‹ jobs
   - é¢¨éšªï¼šæœ€ä½
   - ä½œç‚ºé©—è­‰å‡ç´šæµç¨‹çš„æ¸¬è©¦æ¡ˆä¾‹

2. **ç¬¬äºŒæ‰¹ï¼šMCP Servers CD**ï¼ˆ1 å°æ™‚ï¼‰
   - ç†ç”±ï¼šä¸­ç­‰è¤‡é›œåº¦ï¼Œéœ€è¦æ·»åŠ  PR è§¸ç™¼
   - é¢¨éšªï¼šä¸­ç­‰ï¼ˆä½¿ç”¨å¯é‡ç”¨ workflowï¼‰
   - é©—è­‰å¯é‡ç”¨ workflow å ´æ™¯

3. **ç¬¬ä¸‰æ‰¹ï¼šDeploy Contracts L1**ï¼ˆ2-3 å°æ™‚ï¼‰
   - ç†ç”±ï¼šæœ€è¤‡é›œï¼Œå¤šéšæ®µéƒ¨ç½²æµç¨‹
   - é¢¨éšªï¼šè¼ƒé«˜ï¼ˆè¤‡é›œçš„ job ä¾è³´é—œä¿‚ï¼‰
   - æœ€å¾Œè™•ç†ä»¥ç©ç´¯ç¶“é©—

### æ™‚é–“ç·š

| éšæ®µ | æ™‚é–“ | ä»»å‹™ | é©—è­‰ |
|------|------|------|------|
| æº–å‚™ | 30 min | æ–‡æª”å¯©æŸ¥ã€ç’°å¢ƒæº–å‚™ | âœ“ ç†è§£æ‰€æœ‰ workflows |
| ç¬¬ä¸€æ‰¹ | 1-2 h | Auto-Fix Bot å‡ç´š | PR æ¸¬è©¦ã€å¤±æ•—æ¸¬è©¦ |
| ç¬¬äºŒæ‰¹ | 1 h | MCP Servers CD å‡ç´š | PR è§¸ç™¼æ¸¬è©¦ |
| ç¬¬ä¸‰æ‰¹ | 2-3 h | Deploy Contracts L1 å‡ç´š | å®Œæ•´éƒ¨ç½²æµç¨‹æ¸¬è©¦ |
| æ–‡æª” | 30 min | æ›´æ–°æ–‡æª”ã€ç¸½çµ | æ–‡æª”å¯©æŸ¥ |
| **ç¸½è¨ˆ** | **5-7 h** | | |

### æª¢æŸ¥æ¸…å–®

#### æ¯å€‹ Workflow å‡ç´šå‰

- [ ] é–±è®€ä¸¦ç†è§£ workflow çš„å®Œæ•´é‚è¼¯
- [ ] è­˜åˆ¥æ‰€æœ‰é—œéµ jobs å’Œä¾è³´é—œä¿‚
- [ ] ç¢ºå®šè§¸ç™¼æ¢ä»¶å’ŒåŸ·è¡Œå ´æ™¯
- [ ] è¨­è¨ˆç‹€æ…‹è¨ˆç®—é‚è¼¯
- [ ] è¦åŠƒéŒ¯èª¤è¨ºæ–·ç­–ç•¥

#### æ¯å€‹ Workflow å‡ç´šå¾Œ

- [ ] YAML èªæ³•é©—è­‰é€šé
- [ ] æ¬Šé™é…ç½®æ­£ç¢ºï¼ˆæœ€å°æ¬Šé™ï¼‰
- [ ] æ¢ä»¶é‚è¼¯åˆç†ï¼ˆåƒ… PR æ™‚è§¸ç™¼ï¼‰
- [ ] ç‹€æ…‹è¨ˆç®—é‚è¼¯æ­£ç¢º
- [ ] ä¸Šä¸‹æ–‡ä¿¡æ¯è±å¯Œ
- [ ] éŒ¯èª¤æ—¥èªŒæœ‰æ„ç¾©
- [ ] æ·»åŠ è¨­è¨ˆèªªæ˜è¨»è§£
- [ ] PR æ¸¬è©¦é€šé
- [ ] Push æ¸¬è©¦é€šéï¼ˆä¸ç”¢ç”Ÿè©•è«–ï¼‰
- [ ] å¤±æ•—å ´æ™¯æ¸¬è©¦é€šé
- [ ] æ–‡æª”æ›´æ–°å®Œæ•´

---

## ğŸ“‹ éŒ¯èª¤è¨ºæ–·ç­–ç•¥

### Deploy Contracts L1

| å¤±æ•—é¡å‹ | å¯èƒ½åŸå›  | ä¿®å¾©å»ºè­° |
|---------|---------|---------|
| Build å¤±æ•— | TypeScript éŒ¯èª¤ | æª¢æŸ¥ç·¨è­¯éŒ¯èª¤ã€ä¾è³´ç‰ˆæœ¬ |
| Docker å¤±æ•— | é¡åƒå»ºç½®å•é¡Œ | æª¢æŸ¥ Dockerfileã€åŸºç¤é¡åƒ |
| Security å¤±æ•— | æ¼æ´æª¢æ¸¬ | æ›´æ–°ä¾è³´ã€æŸ¥çœ‹ Trivy å ±å‘Š |
| Deploy å¤±æ•— | ç’°å¢ƒé…ç½® | æª¢æŸ¥ secretsã€k8s é…ç½® |

### Auto-Fix Bot

| å¤±æ•—é¡å‹ | å¯èƒ½åŸå›  | ä¿®å¾©å»ºè­° |
|---------|---------|---------|
| åˆ†æå¤±æ•— | ä»£ç¢¼æƒæå•é¡Œ | æª¢æŸ¥æ–‡ä»¶æ¬Šé™ã€ä¾è³´ |
| å§”æ´¾å¤±æ•— | é›²ç«¯é€£æ¥å•é¡Œ | æª¢æŸ¥ç¶²è·¯ã€æ†‘è­‰ |
| å ±å‘Šå¤±æ•— | æ•¸æ“šæ”¶é›†å•é¡Œ | æŸ¥çœ‹æ—¥èªŒã€æ ¼å¼åŒ–é‚è¼¯ |

### MCP Servers CD

| å¤±æ•—é¡å‹ | å¯èƒ½åŸå›  | ä¿®å¾©å»ºè­° |
|---------|---------|---------|
| CD å¤±æ•— | å®¹å™¨å»ºç½®å•é¡Œ | æŸ¥çœ‹ project-cd.yml æ—¥èªŒ |
| Cosign å¤±æ•— | ç°½åé…ç½® | æª¢æŸ¥ COSIGN_PRIVATE_KEY |
| SBOM å¤±æ•— | ä¾è³´æƒæ | æª¢æŸ¥ä¾è³´çµæ§‹ |

---

## ğŸ¨ æœ€ä½³å¯¦è¸

### å¾å·²å®Œæˆçš„ 7 å€‹ CI å­¸åˆ°çš„ç¶“é©—

1. **æ¢ä»¶é‚è¼¯è¦æ¸…æ™°**
   - âœ… ä½¿ç”¨ `if: always() && github.event_name == 'pull_request'`
   - âœ… æ·»åŠ è¨»è§£èªªæ˜åŸå› 

2. **ç‹€æ…‹è¨ˆç®—è¦å…¨é¢**
   - âœ… è€ƒæ…®æ‰€æœ‰é—œéµ jobs
   - âœ… ä½¿ç”¨ `&&` å’Œ `||` é‚è¼¯é‹ç®—ç¬¦
   - âœ… è™•ç†å¯é¸ jobsï¼ˆå¯èƒ½è¢«è·³éï¼‰

3. **ä¸Šä¸‹æ–‡è¦è±å¯Œ**
   - âœ… æä¾›æ‰€æœ‰ jobs çš„çµæœ
   - âœ… åŒ…å«è§¸ç™¼é¡å‹å’Œç’°å¢ƒä¿¡æ¯
   - âœ… ä½¿ç”¨ JSON æ ¼å¼

4. **éŒ¯èª¤æ—¥èªŒè¦æœ‰æ„ç¾©**
   - âœ… ä¸è¦ä½¿ç”¨é€šç”¨çš„ã€Œå¤±æ•—ã€è¨Šæ¯
   - âœ… æä¾›å…·é«”çš„å¤±æ•—é¡å‹
   - âœ… å¼•å°é–‹ç™¼è€…æŸ¥çœ‹æ­£ç¢ºçš„æ—¥èªŒ

5. **æ¬Šé™è¦æœ€å°åŒ–**
   - âœ… åƒ…æ·»åŠ å¿…è¦çš„æ¬Šé™
   - âœ… åœ¨äº’å‹•å¼æœå‹™ job ä¸­æ˜ç¢ºæŒ‡å®š
   - âœ… ä¸è¦ä½¿ç”¨ `write-all`

---

## ğŸ”® æœªä¾†æ”¹é€²æ–¹å‘

### çŸ­æœŸï¼ˆå®Œæˆé€™ 3 å€‹å¾Œï¼‰

- [ ] å‰µå»ºéƒ¨ç½² CI å‡ç´šç¸½çµæ–‡æª”
- [ ] çµ±è¨ˆæ‰€æœ‰å‡ç´šçš„ CI æ•¸é‡ï¼ˆ7 + 3 = 10ï¼‰
- [ ] æ›´æ–° CI_BATCH_UPGRADE_SUMMARY.md

### ä¸­æœŸï¼ˆ2-4 é€±ï¼‰

- [ ] å„ªåŒ–éƒ¨ç½²ç›¸é—œçš„éŒ¯èª¤è¨ºæ–·é‚è¼¯
  - Docker å»ºç½®å¤±æ•—çš„æ™ºèƒ½è­˜åˆ¥
  - å®‰å…¨æ¼æ´çš„åš´é‡ç¨‹åº¦åˆ†æ
  - éƒ¨ç½²å¤±æ•—çš„ç’°å¢ƒå•é¡Œè¨ºæ–·

- [ ] æ·»åŠ éƒ¨ç½²ç›¸é—œçš„å¿«é€Ÿä¿®å¾©å‘½ä»¤
  - Docker æ¸…ç†å‘½ä»¤
  - ä¾è³´æ›´æ–°å‘½ä»¤
  - ç’°å¢ƒè®Šæ•¸æª¢æŸ¥è…³æœ¬

### é•·æœŸï¼ˆ1-3 å€‹æœˆï¼‰

- [ ] éƒ¨ç½²æµç¨‹å¯è¦–åŒ–
  - éƒ¨ç½²é€²åº¦è¿½è¹¤
  - ç’°å¢ƒå¥åº·åº¦ç›£æ§
  - å›æ»¾å»ºè­°

- [ ] AI è¼”åŠ©éƒ¨ç½²è¨ºæ–·
  - è‡ªå‹•è­˜åˆ¥éƒ¨ç½²æ¨¡å¼
  - é æ¸¬æ½›åœ¨å•é¡Œ
  - ç”Ÿæˆä¿®å¾© PR

---

## ğŸ“Š å‡ç´šå®Œæˆå¾Œçš„çµ±è¨ˆ

### é æœŸçµæœ

| æŒ‡æ¨™ | ç•¶å‰ | å‡ç´šå¾Œ | è®ŠåŒ– |
|------|------|--------|------|
| å‡ç´š CI ç¸½æ•¸ | 7 å€‹ | 10 å€‹ | +43% |
| éƒ¨ç½² CI è¦†è“‹ç‡ | 0% | 100% | +100% |
| äº’å‹•å¼è¨ºæ–·è¦†è“‹ | 70% | 100% | +30% |
| è³‡æºæ•ˆç‡ | åŸºæº– | -50% è©•è«– | å„ªåŒ– |

### è¦†è“‹ç¯„åœ

**å·²å‡ç´šï¼ˆ7 å€‹ï¼‰**ï¼š
1. âœ… Integration & Deployment
2. âœ… Stage 1 Basic CI
3. âœ… Language Compliance Check
4. âœ… CodeQL Advanced
5. âœ… Auto Vulnerability Fix
6. âœ… Security Compliance Report
7. âœ… Phase 1 Integration

**è¨ˆåŠƒå‡ç´šï¼ˆ3 å€‹ï¼‰**ï¼š
8. ğŸ”„ Deploy Contracts L1
9. ğŸ”„ Auto-Fix Bot
10. ğŸ”„ MCP Servers CD

**å®Œæˆå¾Œ**ï¼š
- âœ… æ‰€æœ‰é—œéµ CI 100% è¦†è“‹
- âœ… åŒ…å«æ¸¬è©¦ã€å®‰å…¨ã€éƒ¨ç½²ã€åˆ†æç­‰å„é¡å‹
- âœ… çµ±ä¸€çš„æ™ºèƒ½è¨ºæ–·é«”é©—

---

## ğŸ“ ç¸½çµ

æœ¬å‡ç´šè¨ˆåŠƒæä¾›äº†è©³ç´°çš„å¯¦æ–½è·¯ç·šåœ–ï¼Œç¢ºä¿å‰©é¤˜ 3 å€‹éƒ¨ç½² CI èƒ½å¤ é †åˆ©æ•´åˆåˆ°äº’å‹•å¼ CI æœå‹™ç³»çµ±ä¸­ã€‚

### é—œéµè¦é»

1. **æ¼¸é€²å¼å‡ç´š** - å¾ç°¡å–®åˆ°è¤‡é›œï¼Œé™ä½é¢¨éšª
2. **ä¿æŒåŠŸèƒ½å®Œæ•´** - ä¸ç ´å£ç¾æœ‰éƒ¨ç½²æµç¨‹
3. **å°ˆæ³¨å¤±æ•—è¨ºæ–·** - åƒ…åœ¨éœ€è¦æ™‚æä¾›å¹«åŠ©
4. **è©³ç´°çš„æ¸¬è©¦è¨ˆåŠƒ** - ç¢ºä¿æ¯å€‹å‡ç´šéƒ½ç¶“éé©—è­‰

### é æœŸæˆæœ

å®Œæˆå¾Œï¼ŒSLASolve å°‡æ“æœ‰ï¼š
- âœ… **10 å€‹å®Œæ•´å‡ç´šçš„ CI workflows**
- âœ… **çµ±ä¸€çš„æ™ºèƒ½è¨ºæ–·é«”é©—**
- âœ… **é«˜æ•ˆçš„è³‡æºåˆ©ç”¨**
- âœ… **å“è¶Šçš„é–‹ç™¼è€…é«”é©—**

---

**è¦åŠƒæ—¥æœŸ**: 2025-11-26  
**ç‰ˆæœ¬**: v2.1  
**é è¨ˆå®Œæˆ**: 1-2 é€±å…§  
**è¦åŠƒè€…**: SLASolve Team
