# Module Environment Matrix
# 模組環境需求映射表
#
# Purpose: Define environment and dependency requirements per module
# to avoid hardcoded dependencies and enable proper governance
#
# Design Principles:
# - No hardcoded dependencies in deployment scripts
# - Each module declares its own requirements
# - Conditional dependency loading based on module type
# - Language boundary enforcement

version: "1.0"
metadata:
  created: "2025-11-25"
  purpose: "Environment differentiation governance"
  principle: "Avoid one-size-fits-all dependency management"

# Language Dimension Mapping
# 語言維度映射
language_dimensions:
  popular_languages:
    languages: ["python", "javascript", "typescript", "go", "rust"]
    use_case: "Rapid prototyping, governance automation, cross-platform tools"
    deployment_prompt: |
      Generate governance automation code primarily in Python/Go, covering module responsibility matrix,
      error classification, and event tracking. Ensure code can execute directly in CI/CD pipeline,
      and provide TypeScript examples for frontend governance support.
  
  server_side_languages:
    languages: ["java", "csharp", "nodejs", "kotlin", "scala"]
    use_case: "Backend API, microservices governance, enterprise systems"
    deployment_prompt: |
      Generate server-side governance code primarily in Java/C#, defining API boundaries,
      error tolerance strategies, and security modules. Ensure code integrates with microservices
      architecture and supports event-driven governance.
  
  web_languages:
    languages: ["javascript", "typescript", "html", "css"]
    use_case: "UI governance observation, frontend SDK encapsulation, governance visualization"
    deployment_prompt: |
      Generate Web governance code primarily in TypeScript/HTML, transforming PR/Workflow views
      into governance observability dashboards. Code must display module status, role interactions,
      error classification, and enforce language boundary consistency.
  
  mobile_languages:
    languages: ["swift", "kotlin", "dart", "react-native"]
    use_case: "Mobile governance SDK, observation modules, cross-platform tools"
    deployment_prompt: |
      Generate mobile governance code primarily in Swift/Kotlin, encapsulating SDK modules
      with cross-platform support. Code must include Quickstart examples and enforce
      language boundary consistency.
  
  data_representation_languages:
    languages: ["json", "yaml", "xml", "protobuf"]
    use_case: "Governance boundary documents, responsibility matrix, event logs, config management"
    deployment_prompt: |
      Generate governance data representation files primarily in JSON/YAML, defining module
      responsibility matrix, API specs, and event tracking logs. Files must be parseable by
      automation tools and support version compatibility verification.
  
  other_languages:
    languages: ["cpp", "c", "haskell", "elixir", "zig"]
    use_case: "High-performance governance modules, security hardening, functional governance logic"
    deployment_prompt: |
      Generate high-performance governance code primarily in C++/Rust, focusing on security
      modules and event-driven architecture. Code must support memory safety checks and
      provide functional language examples for governance closure verification.

# Module Environment Requirements
# 模組環境需求定義
modules:
  # Core Services (Node.js/TypeScript)
  core:
    primary_language: "typescript"
    language_dimension: "server_side_languages"
    runtime: "nodejs >= 18.0.0"
    package_manager: "npm >= 8.0.0"
    optional_dependencies: []
    deployment_conditions:
      - "requires_nodejs: true"
      - "requires_python: false"
  
  # Contracts Service (TypeScript)
  "core/contracts":
    primary_language: "typescript"
    language_dimension: "server_side_languages"
    runtime: "nodejs >= 18.0.0"
    package_manager: "npm >= 8.0.0"
    optional_dependencies: []
    deployment_conditions:
      - "requires_nodejs: true"
      - "requires_python: false"
  
  # Intelligent Automation (Python - Optional)
  "intelligent-automation":
    primary_language: "python"
    language_dimension: "popular_languages"
    runtime: "python >= 3.8"  # Flexible, not hardcoded to 3.10
    package_manager: "pip"
    optional_dependencies:
      - "python-dotenv: for environment configuration"
      - "loguru: for enhanced logging"
      - "pytest: for testing"
    deployment_conditions:
      - "requires_python: true"
      - "requires_nodejs: false"
      - "optional_ai_ml: true"  # Can work without AI/ML dependencies
    notes: |
      This module uses a plugin architecture. Core functionality works without
      external AI/ML dependencies. ModelScope API and similar services are
      OPTIONAL and should not be hardcoded in deployment scripts.
  
  # MCP Servers (TypeScript)
  "mcp-servers":
    primary_language: "typescript"
    language_dimension: "server_side_languages"
    runtime: "nodejs >= 18.0.0"
    package_manager: "npm >= 8.0.0"
    optional_dependencies: []
    deployment_conditions:
      - "requires_nodejs: true"
      - "requires_python: false"
  
  # Advanced System (TypeScript/Mixed)
  "advanced-system-src":
    primary_language: "typescript"
    language_dimension: "web_languages"
    runtime: "nodejs >= 18.0.0"
    package_manager: "npm >= 8.0.0"
    optional_dependencies: []
    deployment_conditions:
      - "requires_nodejs: true"
      - "requires_python: false"
  
  # Scripts and Automation (Shell/Python/Mixed)
  scripts:
    primary_language: "shell"
    language_dimension: "popular_languages"
    runtime: "bash"
    secondary_languages: ["python", "javascript"]
    deployment_conditions:
      - "requires_shell: true"
      - "requires_python: conditional"  # Only if script uses Python
      - "requires_nodejs: conditional"  # Only if script uses Node.js
    notes: |
      Deployment scripts should check for language requirements dynamically
      and only install dependencies when needed.

# Deployment Strategy
# 部署策略
deployment_strategy:
  principle: "Conditional dependency installation"
  rules:
    - "Never assume all projects need the same dependencies"
    - "Check module type before installing dependencies"
    - "Use module-environment-matrix to determine requirements"
    - "Fail gracefully if optional dependencies are missing"
    - "Provide clear error messages for missing required dependencies"
  
  implementation:
    ci_cd_check: |
      # Example CI/CD conditional check
      if [ -f "intelligent-automation/requirements.txt" ]; then
        echo "Python module detected, installing Python dependencies"
        pip install -r intelligent-automation/requirements.txt
      fi
      
      if [ -f "package.json" ]; then
        echo "Node.js project detected, installing npm dependencies"
        npm install
      fi
    
    fallback_strategy: |
      # If module-specific requirements are missing, use default minimal set
      # Do NOT fallback to a template that includes unneeded dependencies

# Governance Validation
# 治理驗證
validation:
  checks:
    - name: "No hardcoded Python version in deployment"
      rule: "Deployment scripts must not hardcode Python 3.10"
      action: "Use module-environment-matrix to determine Python version"
    
    - name: "No hardcoded ModelScope API requirement"
      rule: "ModelScope API is OPTIONAL for intelligent-automation"
      action: "Check for optional dependencies before requiring them"
    
    - name: "Language boundary enforcement"
      rule: "Each module declares its language requirements"
      action: "Deployment validates language compatibility"
    
    - name: "Conditional dependency loading"
      rule: "Install dependencies only when module requires them"
      action: "Use module type detection in CI/CD"

# Language Boundary Documentation
# 語言邊界文檔
language_boundaries:
  enforcement: "strict"
  policy: |
    - Internal code and documentation: Traditional Chinese (繁體中文)
    - External integration or third-party deliverables: English (when required)
    - API examples: Bilingual (Chinese primary, English optional)
    - Error messages: Bilingual
  
  transition_points:
    - "Public API documentation: Add English translation"
    - "Third-party integration: Provide English version"
    - "Internal governance: Chinese only"
